import{d as J,k as K,r as i,ad as O,n as W,o as X,c as D,e as b,f as a,t as s,w as l,g as r,aL as C,E as u,y as m,i as E,B as Y,p as Z,$ as x,q as B,as as ee,at as ae,G as te,Q as le,ac as oe,h as p}from"./index-DaxlKADp.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";const re={class:"category-management"},se={class:"page-header"},ie={class:"category-name"},ce={class:"description-text"},de={key:1,class:"no-parent"},ue=J({__name:"CategoryManagementView",setup(me){const{t:pe}=K(),h=i(!1),$=i(!1),c=i(!1),f=i(!1),g=i([]),d=i(null),w=i(),n=O({name:"",description:"",parent:null}),F={name:[{required:!0,message:"Please enter category name",trigger:"blur"},{min:2,max:100,message:"Name must be 2-100 characters",trigger:"blur"}]},M=W(()=>!f.value||!d.value?g.value:g.value.filter(e=>e.id!==d.value)),k=async()=>{h.value=!0;try{const e=await C.getCategories();g.value=Array.isArray(e)?e:e.data||[]}catch(e){console.error("Failed to fetch categories:",e),u.error("Failed to load categories")}finally{h.value=!1}},N=e=>g.value.find(y=>y.id===e)?.name||e,A=()=>{f.value=!1,d.value=null,n.name="",n.description="",n.parent=null,c.value=!0},S=e=>{f.value=!0,d.value=e.id,n.name=e.name,n.description=e.description||"",n.parent=e.parent||null,c.value=!0},U=async()=>{w.value&&await w.value.validate(async e=>{if(e){$.value=!0;try{const o={name:n.name,description:n.description,parent:n.parent};f.value&&d.value?(await C.updateCategory(d.value,o),u.success("Category updated successfully")):(await C.createCategory(o),u.success("Category created successfully")),c.value=!1,k()}catch(o){console.error("Failed to save category:",o),u.error(o.response?.data?.detail||"Failed to save category")}finally{$.value=!1}}})},z=async e=>{try{await oe.confirm(`Are you sure you want to delete category "${e.name}"?`,"Confirm Delete",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"}),await C.deleteCategory(e.id),u.success("Category deleted successfully"),k()}catch(o){o!=="cancel"&&(console.error("Failed to delete category:",o),u.error(o.response?.data?.detail||"Failed to delete category"))}};return X(()=>{k()}),(e,o)=>{const y=r("el-icon"),_=r("el-button"),v=r("el-table-column"),T=r("el-tag"),q=r("el-table"),I=r("el-card"),P=r("el-input"),V=r("el-form-item"),L=r("el-option"),R=r("el-select"),G=r("el-form"),Q=r("el-dialog"),j=x("loading");return p(),D("div",re,[b("div",se,[b("h1",null,s(e.$t("nav.categoryManagement")||"Category Management"),1),a(_,{type:"primary",onClick:A},{default:l(()=>[a(y,null,{default:l(()=>[a(E(Y))]),_:1}),m(" "+s(e.$t("common.create")||"Create Category"),1)]),_:1})]),a(I,{class:"table-card"},{default:l(()=>[Z((p(),B(q,{data:g.value,stripe:"",style:{width:"100%"}},{default:l(()=>[a(v,{prop:"name",label:e.$t("common.name")||"Name","min-width":"180"},{default:l(({row:t})=>[b("span",ie,s(t.name),1)]),_:1},8,["label"]),a(v,{prop:"description",label:e.$t("common.description")||"Description","min-width":"250"},{default:l(({row:t})=>[b("span",ce,s(t.description||"-"),1)]),_:1},8,["label"]),a(v,{prop:"parent",label:e.$t("category.parent")||"Parent Category","min-width":"150"},{default:l(({row:t})=>[t.parent?(p(),B(T,{key:0,type:"info",size:"small"},{default:l(()=>[m(s(N(t.parent)),1)]),_:2},1024)):(p(),D("span",de,"-"))]),_:1},8,["label"]),a(v,{label:e.$t("common.actions")||"Actions",width:"180",fixed:"right"},{default:l(({row:t})=>[a(_,{type:"primary",link:"",size:"small",onClick:H=>S(t)},{default:l(()=>[a(y,null,{default:l(()=>[a(E(ee))]),_:1}),m(" "+s(e.$t("common.edit")||"Edit"),1)]),_:1},8,["onClick"]),a(_,{type:"danger",link:"",size:"small",onClick:H=>z(t)},{default:l(()=>[a(y,null,{default:l(()=>[a(E(ae))]),_:1}),m(" "+s(e.$t("common.delete")||"Delete"),1)]),_:1},8,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[j,h.value]])]),_:1}),a(Q,{modelValue:c.value,"onUpdate:modelValue":o[4]||(o[4]=t=>c.value=t),title:f.value?e.$t("category.edit")||"Edit Category":e.$t("category.create")||"Create Category",width:"500px","close-on-click-modal":!1},{footer:l(()=>[a(_,{onClick:o[3]||(o[3]=t=>c.value=!1)},{default:l(()=>[m(s(e.$t("common.cancel")||"Cancel"),1)]),_:1}),a(_,{type:"primary",loading:$.value,onClick:U},{default:l(()=>[m(s(e.$t("common.save")||"Save"),1)]),_:1},8,["loading"])]),default:l(()=>[a(G,{ref_key:"formRef",ref:w,model:n,rules:F,"label-width":"120px","label-position":"top"},{default:l(()=>[a(V,{label:e.$t("common.name")||"Name",prop:"name"},{default:l(()=>[a(P,{modelValue:n.name,"onUpdate:modelValue":o[0]||(o[0]=t=>n.name=t),placeholder:e.$t("category.namePlaceholder")||"Enter category name"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(V,{label:e.$t("common.description")||"Description",prop:"description"},{default:l(()=>[a(P,{modelValue:n.description,"onUpdate:modelValue":o[1]||(o[1]=t=>n.description=t),type:"textarea",rows:3,placeholder:e.$t("category.descriptionPlaceholder")||"Enter description (optional)"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(V,{label:e.$t("category.parent")||"Parent Category",prop:"parent"},{default:l(()=>[a(R,{modelValue:n.parent,"onUpdate:modelValue":o[2]||(o[2]=t=>n.parent=t),placeholder:e.$t("category.selectParent")||"Select parent category (optional)",clearable:"",style:{width:"100%"}},{default:l(()=>[(p(!0),D(te,null,le(M.value,t=>(p(),B(L,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),ye=ne(ue,[["__scopeId","data-v-d8e28e0a"]]);export{ye as default};
