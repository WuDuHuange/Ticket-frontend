import{d as G,k as J,l as Q,r as d,aa as W,o as X,c as y,e as r,q as D,s as Y,f as e,t as a,w as l,g as n,F as P,O as q,i as k,j as Z,a8 as x,y as u,ab as ee,b as te,h as p,I as le,E as V}from"./index-C3uyuHtt.js";import{u as oe}from"./ticket-B5lzEKGK.js";import{u as se}from"./knowledge-Dc1nrdqu.js";import{e as ae}from"./helpers-BtQK9j-g.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-BrCbebx6.js";import"./tickets-CV57FQXZ.js";const re={class:"create-ticket-view"},ne={class:"page-header"},ce={class:"card-header"},de={class:"suggestion-list"},ue=["onClick"],pe={class:"priority-desc"},me={class:"priority-desc"},fe={class:"priority-desc"},ge={class:"priority-desc"},_e={class:"upload-text"},ye={class:"upload-tip"},ke=G({__name:"CreateTicketView",setup(he){const h=te(),{t:I}=J(),m=oe(),b=se(),B=Q(),v=d(),L=d(),$=d(!1),C=d([]),i=W({title:"",categoryId:"",priority:"medium",description:""}),M={title:[{required:!0,message:"Please enter a title",trigger:"blur"},{min:10,message:"Title must be at least 10 characters",trigger:"blur"}],categoryId:[{required:!0,message:"Please select a category",trigger:"change"}],priority:[{required:!0,message:"Please select a priority",trigger:"change"}],description:[{required:!0,message:"Please enter a description",trigger:"blur"},{min:20,message:"Description must be at least 20 characters",trigger:"blur"}]},S=d(m.categories),f=d(b.suggestedArticles),R=ae(async()=>{i.title.length>=5?(await b.fetchSuggestedArticles(i.title),f.value=b.suggestedArticles):f.value=[]},500);X(async()=>{B.setBreadcrumbs([{label:I("nav.dashboard"),path:"/"},{label:I("nav.submitTicket")}]),await m.fetchCategories(),S.value=m.categories});function N(t){h.push(`/knowledge/${t}`)}async function j(){v.value&&await v.value.validate(async t=>{if(t){$.value=!0;try{const s=await m.createTicket({title:i.title,categoryId:i.categoryId,priority:i.priority,description:i.description});s.success&&s.ticket?(V.success("Ticket submitted successfully!"),h.push(`/tickets/${s.ticket.id}`)):V.error(s.message||"Failed to submit ticket")}catch{V.error("An error occurred while submitting the ticket")}finally{$.value=!1}}})}function E(){h.back()}return(t,s)=>{const w=n("el-icon"),T=n("el-card"),U=n("el-input"),c=n("el-form-item"),F=n("el-option"),z=n("el-select"),g=n("el-tag"),_=n("el-radio"),H=n("el-radio-group"),K=n("el-upload"),A=n("el-button"),O=n("el-form");return p(),y("div",re,[r("div",ne,[r("h1",null,a(t.$t("tickets.submitTicket")),1),r("p",null,a(t.$t("tickets.submitDesc")),1)]),f.value.length>0?(p(),D(T,{key:0,class:"suggestions-card"},{header:l(()=>[r("div",ce,[e(w,null,{default:l(()=>[e(k(Z))]),_:1}),r("span",null,a(t.$t("tickets.suggestedArticles")),1)])]),default:l(()=>[r("div",de,[(p(!0),y(P,null,q(f.value,o=>(p(),y("div",{key:o.id,class:"suggestion-item",onClick:be=>N(o.id)},[e(w,null,{default:l(()=>[e(k(le))]),_:1}),r("span",null,a(o.title),1)],8,ue))),128))])]),_:1})):Y("",!0),e(T,{class:"form-card"},{default:l(()=>[e(O,{ref_key:"formRef",ref:v,model:i,rules:M,"label-position":"top",onSubmit:x(j,["prevent"])},{default:l(()=>[e(c,{label:t.$t("common.title"),prop:"title"},{default:l(()=>[e(U,{modelValue:i.title,"onUpdate:modelValue":s[0]||(s[0]=o=>i.title=o),placeholder:t.$t("tickets.titlePlaceholder"),maxlength:"200","show-word-limit":"",onInput:k(R)},null,8,["modelValue","placeholder","onInput"])]),_:1},8,["label"]),e(c,{label:t.$t("common.category"),prop:"categoryId"},{default:l(()=>[e(z,{modelValue:i.categoryId,"onUpdate:modelValue":s[1]||(s[1]=o=>i.categoryId=o),placeholder:t.$t("tickets.selectCategory"),style:{width:"100%"}},{default:l(()=>[(p(!0),y(P,null,q(S.value,o=>(p(),D(F,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),e(c,{label:t.$t("common.priority"),prop:"priority"},{default:l(()=>[e(H,{modelValue:i.priority,"onUpdate:modelValue":s[2]||(s[2]=o=>i.priority=o)},{default:l(()=>[e(_,{value:"low"},{default:l(()=>[e(g,{type:"info",effect:"plain"},{default:l(()=>[u(a(t.$t("tickets.priorityLow")),1)]),_:1}),r("span",pe,a(t.$t("tickets.priorityLowDesc")),1)]),_:1}),e(_,{value:"medium"},{default:l(()=>[e(g,{effect:"plain"},{default:l(()=>[u(a(t.$t("tickets.priorityMedium")),1)]),_:1}),r("span",me,a(t.$t("tickets.priorityMediumDesc")),1)]),_:1}),e(_,{value:"high"},{default:l(()=>[e(g,{type:"warning",effect:"plain"},{default:l(()=>[u(a(t.$t("tickets.priorityHigh")),1)]),_:1}),r("span",fe,a(t.$t("tickets.priorityHighDesc")),1)]),_:1}),e(_,{value:"urgent"},{default:l(()=>[e(g,{type:"danger",effect:"plain"},{default:l(()=>[u(a(t.$t("tickets.priorityUrgent")),1)]),_:1}),r("span",ge,a(t.$t("tickets.priorityUrgentDesc")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),e(c,{label:t.$t("common.description"),prop:"description"},{default:l(()=>[e(U,{modelValue:i.description,"onUpdate:modelValue":s[3]||(s[3]=o=>i.description=o),type:"textarea",rows:6,placeholder:t.$t("tickets.descriptionPlaceholder"),maxlength:"5000","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(c,{label:t.$t("tickets.attachments")},{default:l(()=>[e(K,{ref_key:"uploadRef",ref:L,"file-list":C.value,"onUpdate:fileList":s[4]||(s[4]=o=>C.value=o),class:"upload-area",drag:"",multiple:"","auto-upload":!1,limit:5,accept:".jpg,.jpeg,.png,.gif,.pdf,.doc,.docx,.txt,.log"},{tip:l(()=>[r("div",ye,a(t.$t("tickets.uploadTip")),1)]),default:l(()=>[e(w,{class:"upload-icon"},{default:l(()=>[e(k(ee))]),_:1}),r("div",_e,a(t.$t("tickets.uploadText")),1)]),_:1},8,["file-list"])]),_:1},8,["label"]),e(c,null,{default:l(()=>[e(A,{type:"primary","native-type":"submit",size:"large",loading:$.value},{default:l(()=>[u(a(t.$t("common.submit")),1)]),_:1},8,["loading"]),e(A,{size:"large",onClick:E},{default:l(()=>[u(a(t.$t("common.cancel")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}}),Te=ie(ke,[["__scopeId","data-v-a2916316"]]);export{Te as default};
