import{av as M,r as l,p as g,a1 as n}from"./index-Bo1QE9TC.js";const U=M("ticket",()=>{const o=l([]),u=l(null),m=l([]),d=l({page:1,pageSize:10,total:0,totalPages:0}),c=l(!1),f=l({}),k=g(()=>o.value.length),p=g(()=>o.value.filter(t=>t.status==="new")),y=g(()=>o.value.filter(t=>["new","assigned","in_progress","pending_user"].includes(t.status))),T=g(()=>o.value.filter(t=>["resolved","closed"].includes(t.status)));async function h(t=1,a=10,s){c.value=!0;try{const e={...f.value,...s},r=await n.getTickets({page:t,pageSize:a,filter:e});if(r.code===200&&r.data){const i=r.data;o.value=i.items,d.value={page:i.page,pageSize:i.pageSize,total:i.total,totalPages:i.totalPages}}}catch(e){console.error("Fetch tickets error:",e)}finally{c.value=!1}}async function w(t=1,a=10,s){c.value=!0;try{const e=await n.getMyTickets({page:t,pageSize:a,status:s});if(e.code===200&&e.data){const r=e.data;o.value=r.items,d.value={page:r.page,pageSize:r.pageSize,total:r.total,totalPages:r.totalPages}}}catch(e){console.error("Fetch my tickets error:",e)}finally{c.value=!1}}async function F(t=1,a=10,s){c.value=!0;try{const e=await n.getAssignedTickets({page:t,pageSize:a,status:s});if(e.code===200&&e.data){const r=e.data;o.value=r.items,d.value={page:r.page,pageSize:r.pageSize,total:r.total,totalPages:r.totalPages}}}catch(e){console.error("Fetch assigned tickets error:",e)}finally{c.value=!1}}async function v(t){c.value=!0;try{const a=await n.getTicketById(t);return a.code===200&&a.data?(u.value=a.data,a.data):null}catch(a){return console.error("Fetch ticket error:",a),null}finally{c.value=!1}}async function S(t){c.value=!0;try{const a=await n.createTicket(t);return a.code===200&&a.data?{success:!0,ticket:a.data}:{success:!1,message:a.message}}catch(a){return console.error("Create ticket error:",a),{success:!1,message:"Failed to create ticket"}}finally{c.value=!1}}async function x(t,a,s){c.value=!0;try{const e=await n.updateTicketStatus(t,a,s);if(e.code===200&&e.data){u.value=e.data;const r=o.value.findIndex(i=>i.id===t);return r!==-1&&(o.value[r]=e.data),{success:!0}}return{success:!1,message:e.message}}catch(e){return console.error("Update ticket status error:",e),{success:!1,message:"Failed to update ticket status"}}finally{c.value=!1}}async function z(t,a){c.value=!0;try{const s=await n.assignTicket(t,a);if(s.code===200&&s.data){u.value=s.data;const e=o.value.findIndex(r=>r.id===t);return e!==-1&&(o.value[e]=s.data),{success:!0}}return{success:!1,message:s.message}}catch(s){return console.error("Assign ticket error:",s),{success:!1,message:"Failed to assign ticket"}}finally{c.value=!1}}async function P(t,a){c.value=!0;try{const s=await n.assignTicketToTeam(t,a);if(s.code===200&&s.data){u.value=s.data;const e=o.value.findIndex(r=>r.id===t);return e!==-1&&(o.value[e]=s.data),{success:!0}}return{success:!1,message:s.message}}catch(s){return console.error("Assign ticket to team error:",s),{success:!1,message:"Failed to assign ticket to team"}}finally{c.value=!1}}async function b(t,a,s=!1){c.value=!0;try{const e=await n.addComment(t,{content:a,isInternal:s});return e.code===200&&e.data?(await v(t),{success:!0,comment:e.data}):{success:!1,message:e.message}}catch(e){return console.error("Add comment error:",e),{success:!1,message:"Failed to add comment"}}finally{c.value=!1}}async function A(){try{const t=await n.getCategories();t.code===200&&t.data&&(m.value=t.data)}catch(t){console.error("Fetch categories error:",t)}}async function C(t,a,s){c.value=!0;try{const e=await n.submitFeedback(t,{rating:a,comment:s});return e.code===200?(await v(t),{success:!0}):{success:!1,message:e.message}}catch(e){return console.error("Submit satisfaction error:",e),{success:!1,message:"Failed to submit satisfaction feedback"}}finally{c.value=!1}}function I(t){f.value=t}function B(){f.value={}}return{tickets:o,currentTicket:u,categories:m,pagination:d,loading:c,filter:f,ticketCount:k,newTickets:p,openTickets:y,resolvedTickets:T,fetchTickets:h,fetchMyTickets:w,fetchAssignedTickets:F,fetchTicketById:v,createTicket:S,updateTicketStatus:x,assignTicket:z,assignTicketToTeam:P,addComment:b,fetchCategories:A,submitSatisfaction:C,setFilter:I,clearFilter:B}});export{U as u};
