import{d as ne,p as oe,u as ie,q as ce,s as z,r as A,X as de,g as ue,v as re,_ as me,c as _,y as k,z as v,F as B,a as n,b as e,w as t,e as c,t as a,h as r,o as u,i as o,a1 as _e,T as pe,n as fe,Y as ve,a2 as ke,l as D,a3 as he,E as w,f as ge,J as ye,Q as be,a4 as we}from"./index-Myl3Wffr.js";import{u as $e}from"./ticket-b3rCwkfE.js";import{g as R,b as N,a as Ce,f as Se,c as Te,d as Be}from"./helpers-BtW4N_bD.js";import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ve={class:"ticket-detail-view"},Ie={class:"page-header"},ze={class:"header-left"},Ae={key:0,class:"header-right"},De={class:"ticket-title"},Ue={class:"ticket-meta"},Me={class:"ticket-description"},Pe={key:0,class:"attachments-section"},Fe={class:"attachment-list"},qe={class:"attachment-size"},Ee={class:"card-header"},Re={class:"comments-list"},He={class:"comment-header"},Ge={class:"comment-author"},Le={class:"author-name"},je={class:"comment-time"},Je={class:"comment-content"},Qe={class:"add-comment"},Xe={class:"comment-actions"},Ye={class:"history-item"},Ke={class:"history-change"},Oe={class:"history-by"},We={key:0,class:"history-comment"},Ze=ne({__name:"TicketDetailView",setup(xe){const H=ue(),G=ge(),{t:d}=oe(),h=$e(),L=ie(),j=ce(),U=z(()=>h.loading),l=z(()=>h.currentTicket),M=z(()=>L.isStaff),g=A(""),$=A(!1),V=A(!1);function C(s){return{new:d("tickets.statusNew"),assigned:d("tickets.statusAssigned"),in_progress:d("tickets.statusInProgress"),pending_user:d("tickets.statusPendingUser"),resolved:d("tickets.statusResolved"),closed:d("tickets.statusClosed")}[s]||s}de(async()=>{const s=H.params.id;await h.fetchTicketById(s),l.value&&j.setBreadcrumbs([{label:d("nav.dashboard"),path:"/"},{label:d("nav.tickets"),path:"/my-tickets"},{label:l.value.id}])});function P(){G.back()}function J(s){return s.split(" ").map(m=>m[0]).join("").toUpperCase().slice(0,2)}async function Q(s){if(l.value)try{const{value:m}=await we.prompt(d("tickets.statusChangeComment"),d("tickets.changeStatus"),{confirmButtonText:d("common.confirm"),cancelButtonText:d("common.cancel"),inputType:"textarea"}),p=await h.updateTicketStatus(l.value.id,s,m);p.success?w.success(d("tickets.statusUpdated")):w.error(p.message||d("errors.operationFailed"))}catch{}}async function F(){if(!l.value||!g.value.trim()){w.warning(d("tickets.enterComment"));return}V.value=!0;try{const s=await h.addComment(l.value.id,g.value,$.value);s.success?(w.success(d("tickets.commentAdded")),g.value="",$.value=!1):w.error(s.message||d("errors.operationFailed"))}finally{V.value=!1}}return(s,m)=>{const p=c("el-icon"),S=c("el-button"),y=c("el-tag"),b=c("el-dropdown-item"),X=c("el-dropdown-menu"),Y=c("el-dropdown"),q=c("el-divider"),T=c("el-card"),K=c("el-avatar"),I=c("el-empty"),O=c("el-input"),W=c("el-form-item"),Z=c("el-checkbox"),x=c("el-form"),E=c("el-col"),f=c("el-descriptions-item"),ee=c("el-descriptions"),te=c("el-timeline-item"),ae=c("el-timeline"),se=c("el-row"),le=me("loading");return re((u(),_("div",Ve,[l.value?(u(),_(B,{key:0},[n("div",Ie,[n("div",ze,[e(S,{text:"",onClick:P},{default:t(()=>[e(p,null,{default:t(()=>[e(r(_e))]),_:1}),o(" "+a(s.$t("common.back")),1)]),_:1}),n("h1",null,a(l.value.id),1),e(y,{type:r(R)(l.value.status),size:"large"},{default:t(()=>[o(a(C(l.value.status)),1)]),_:1},8,["type"]),l.value.slaBreached?(u(),k(y,{key:0,type:"danger",size:"large"},{default:t(()=>[...m[2]||(m[2]=[o(" SLA ",-1)])]),_:1})):v("",!0)]),M.value?(u(),_("div",Ae,[e(Y,{onCommand:Q},{dropdown:t(()=>[e(X,null,{default:t(()=>[e(b,{command:"assigned",disabled:l.value.status==="assigned"},{default:t(()=>[o(a(s.$t("tickets.assignToMe")),1)]),_:1},8,["disabled"]),e(b,{command:"in_progress",disabled:l.value.status==="in_progress"},{default:t(()=>[o(a(s.$t("tickets.statusInProgress")),1)]),_:1},8,["disabled"]),e(b,{command:"pending_user",disabled:l.value.status==="pending_user"},{default:t(()=>[o(a(s.$t("tickets.statusPendingUser")),1)]),_:1},8,["disabled"]),e(b,{command:"resolved",disabled:l.value.status==="resolved"},{default:t(()=>[o(a(s.$t("tickets.markResolved")),1)]),_:1},8,["disabled"]),e(b,{command:"closed",disabled:l.value.status==="closed"},{default:t(()=>[o(a(s.$t("tickets.closeTicket")),1)]),_:1},8,["disabled"])]),_:1})]),default:t(()=>[e(S,{type:"primary"},{default:t(()=>[o(a(s.$t("tickets.changeStatus"))+" ",1),e(p,{class:"el-icon--right"},{default:t(()=>[e(r(pe))]),_:1})]),_:1})]),_:1})])):v("",!0)]),e(se,{gutter:24},{default:t(()=>[e(E,{xs:24,lg:16},{default:t(()=>[e(T,{class:"info-card"},{default:t(()=>[n("h2",De,a(l.value.title),1),n("div",Ue,[n("span",null,[e(p,null,{default:t(()=>[e(r(fe))]),_:1}),o(" "+a(l.value.requesterName),1)]),n("span",null,[e(p,null,{default:t(()=>[e(r(ve))]),_:1}),o(" "+a(r(N)(l.value.createdAt,"datetime")),1)]),n("span",null,[e(p,null,{default:t(()=>[e(r(ke))]),_:1}),o(" "+a(l.value.category?.name||"General"),1)])]),e(q),n("div",Me,[n("h3",null,a(s.$t("common.description")),1),n("p",null,a(l.value.description),1)]),l.value.attachments&&l.value.attachments.length>0?(u(),_("div",Pe,[n("h3",null,a(s.$t("tickets.attachments")),1),n("div",Fe,[(u(!0),_(B,null,D(l.value.attachments,i=>(u(),_("div",{key:i.id,class:"attachment-item"},[e(p,null,{default:t(()=>[e(r(ye))]),_:1}),n("span",null,a(i.filename),1),n("span",qe,a(r(Te)(i.size)),1)]))),128))])])):v("",!0)]),_:1}),e(T,{class:"comments-card"},{header:t(()=>[n("div",Ee,[n("span",null,a(s.$t("tickets.comments"))+" ("+a(l.value.comments?.length||0)+")",1)])]),default:t(()=>[n("div",Re,[(u(!0),_(B,null,D(l.value.comments,i=>(u(),_("div",{key:i.id,class:be(["comment-item",{internal:i.isInternal}])},[n("div",He,[n("div",Ge,[e(K,{size:32},{default:t(()=>[o(a(J(i.authorName)),1)]),_:2},1024),n("span",Le,a(i.authorName),1),i.isInternal?(u(),k(y,{key:0,type:"warning",size:"small"},{default:t(()=>[o(a(s.$t("tickets.internalNote")),1)]),_:1})):v("",!0)]),n("span",je,a(r(Be)(i.createdAt)),1)]),n("div",Je,a(i.content),1)],2))),128)),l.value.comments?.length?v("",!0):(u(),k(I,{key:0,description:s.$t("tickets.noComments")},null,8,["description"]))]),n("div",Qe,[e(q),e(x,{onSubmit:he(F,["prevent"])},{default:t(()=>[e(W,null,{default:t(()=>[e(O,{modelValue:g.value,"onUpdate:modelValue":m[0]||(m[0]=i=>g.value=i),type:"textarea",rows:3,placeholder:s.$t("tickets.addCommentPlaceholder")},null,8,["modelValue","placeholder"])]),_:1}),n("div",Xe,[M.value?(u(),k(Z,{key:0,modelValue:$.value,"onUpdate:modelValue":m[1]||(m[1]=i=>$.value=i)},{default:t(()=>[o(a(s.$t("tickets.internalNoteDesc")),1)]),_:1},8,["modelValue"])):v("",!0),e(S,{type:"primary",onClick:F,loading:V.value},{default:t(()=>[o(a(s.$t("tickets.addComment")),1)]),_:1},8,["loading"])])]),_:1})])]),_:1})]),_:1}),e(E,{xs:24,lg:8},{default:t(()=>[e(T,{class:"details-card"},{header:t(()=>[n("span",null,a(s.$t("tickets.ticketDetails")),1)]),default:t(()=>[e(ee,{column:1,border:""},{default:t(()=>[e(f,{label:s.$t("common.status")},{default:t(()=>[e(y,{type:r(R)(l.value.status)},{default:t(()=>[o(a(C(l.value.status)),1)]),_:1},8,["type"])]),_:1},8,["label"]),e(f,{label:s.$t("common.priority")},{default:t(()=>[e(y,{type:r(Ce)(l.value.priority),effect:"plain"},{default:t(()=>[o(a(r(Se)(l.value.priority)),1)]),_:1},8,["type"])]),_:1},8,["label"]),e(f,{label:s.$t("common.category")},{default:t(()=>[o(a(l.value.category?.name||"General"),1)]),_:1},8,["label"]),e(f,{label:s.$t("tickets.channel")},{default:t(()=>[o(a(l.value.channel),1)]),_:1},8,["label"]),e(f,{label:s.$t("tickets.requester")},{default:t(()=>[o(a(l.value.requesterName),1)]),_:1},8,["label"]),e(f,{label:s.$t("common.email")},{default:t(()=>[o(a(l.value.requesterEmail),1)]),_:1},8,["label"]),e(f,{label:s.$t("tickets.assignee")},{default:t(()=>[o(a(l.value.assigneeName||s.$t("tickets.unassigned")),1)]),_:1},8,["label"]),e(f,{label:s.$t("common.created")},{default:t(()=>[o(a(r(N)(l.value.createdAt,"datetime")),1)]),_:1},8,["label"]),e(f,{label:s.$t("common.updated")},{default:t(()=>[o(a(r(N)(l.value.updatedAt,"datetime")),1)]),_:1},8,["label"])]),_:1})]),_:1}),e(T,{class:"history-card"},{header:t(()=>[n("span",null,a(s.$t("tickets.statusHistory")),1)]),default:t(()=>[e(ae,null,{default:t(()=>[(u(!0),_(B,null,D(l.value.statusHistory,i=>(u(),k(te,{key:i.id,timestamp:r(N)(i.changedAt,"datetime"),placement:"top"},{default:t(()=>[n("div",Ye,[n("span",Ke,a(C(i.previousStatus))+" â†’ "+a(C(i.newStatus)),1),n("span",Oe,"by "+a(i.changedBy),1),i.comment?(u(),_("p",We,a(i.comment),1)):v("",!0)])]),_:2},1032,["timestamp"]))),128))]),_:1}),l.value.statusHistory?.length?v("",!0):(u(),k(I,{key:0,description:s.$t("tickets.noHistory"),"image-size":60},null,8,["description"]))]),_:1})]),_:1})]),_:1})],64)):U.value?v("",!0):(u(),k(I,{key:1,description:s.$t("tickets.ticketNotFound")},{default:t(()=>[e(S,{type:"primary",onClick:P},{default:t(()=>[o(a(s.$t("knowledge.goBack")),1)]),_:1})]),_:1},8,["description"]))])),[[le,U.value]])}}}),lt=Ne(Ze,[["__scopeId","data-v-fb290f46"]]);export{lt as default};
