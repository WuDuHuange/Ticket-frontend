import{d as Y,p as G,q as J,r as f,s as C,X as K,ap as w,c as m,b as e,w as a,e as d,o as _,a as s,h,B as Q,t as n,a1 as W,a2 as Z,aH as ee,F as D,l as N,a5 as P,i as p,v as B,Y as te,y as V}from"./index-CMTRBr-a.js";import{f as ae}from"./helpers-BtQK9j-g.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";const le={class:"analytics-view"},oe={class:"stat-icon primary"},ne={class:"stat-content"},ce={class:"stat-value"},ie={class:"stat-label"},re={class:"stat-icon warning"},de={class:"stat-content"},ue={class:"stat-value"},_e={class:"stat-label"},pe={class:"stat-icon success"},ve={class:"stat-content"},fe={class:"stat-value"},me={class:"stat-label"},he={class:"stat-icon info"},ge={class:"stat-content"},be={class:"stat-value"},ye={class:"stat-label"},we={class:"chart-placeholder"},ke={class:"status-bars"},Te={class:"bar-label"},Ae={class:"bar-container"},Re={class:"bar-value"},$e={class:"chart-placeholder"},Me={class:"priority-grid"},Se={class:"priority-label"},ze={class:"card-header"},Ce={class:"agent-info"},De={class:"satisfaction"},Ne=Y({__name:"AnalyticsView",setup(Pe){const{t:k}=G(),x=J(),g=f(!1),T=f("30d"),i=f(null),A=f([]),R=f([]),L=C(()=>{if(!i.value)return[];const t=i.value.byStatus,l=i.value.totalCreated||1;return[{label:"New",value:t.new||0,percentage:(t.new||0)/l*100,color:"#909399"},{label:"In Progress",value:t.in_progress||0,percentage:(t.in_progress||0)/l*100,color:"#e6a23c"},{label:"Resolved",value:t.resolved||0,percentage:(t.resolved||0)/l*100,color:"#67c23a"},{label:"Closed",value:t.closed||0,percentage:(t.closed||0)/l*100,color:"#409eff"}]}),U=C(()=>{if(!i.value)return[];const t=i.value.totalCreated||1,l=i.value.byPriority||{low:0,medium:0,high:0,urgent:0};return[{label:"Low",value:l.low,percentage:Math.round(l.low/t*100),color:"#909399",type:"info"},{label:"Medium",value:l.medium,percentage:Math.round(l.medium/t*100),color:"#409eff",type:""},{label:"High",value:l.high,percentage:Math.round(l.high/t*100),color:"#e6a23c",type:"warning"},{label:"Urgent",value:l.urgent,percentage:Math.round(l.urgent/t*100),color:"#f56c6c",type:"danger"}]});function I(t){if(!t)return"0h";if(t<60)return`${t}m`;const l=Math.floor(t/60),c=t%60;return c>0?`${l}h ${c}m`:`${l}h`}function F(t){if(t<60)return`${t}m`;const l=Math.floor(t/60),c=t%60;return c>0?`${l}h ${c}m`:`${l}h`}function H(t){return t.split(" ").map(l=>l[0]).join("").toUpperCase().slice(0,2)}K(async()=>{x.setBreadcrumbs([{label:k("nav.administration")},{label:k("nav.analytics")}]),g.value=!0;try{const[t,l,c]=await Promise.all([w.getTicketAnalytics(),w.getAgentPerformance(),w.getAuditLogs({page:1,pageSize:10})]);t.code===200&&(i.value=t.data),l.code===200&&(A.value=l.data),c.code===200&&(R.value=c.data.items)}finally{g.value=!1}});function j(t){return{create:"success",update:"warning",delete:"danger",login:"info",logout:"info"}[t]||""}function q(t){return t.charAt(0).toUpperCase()+t.slice(1)}return(t,l)=>{const c=d("el-icon"),u=d("el-card"),v=d("el-col"),$=d("el-row"),M=d("el-tag"),b=d("el-option"),E=d("el-select"),O=d("el-avatar"),r=d("el-table-column"),X=d("el-rate"),S=d("el-table"),z=te("loading");return _(),m("div",le,[e($,{gutter:20,class:"stats-row"},{default:a(()=>[e(v,{xs:12,sm:6},{default:a(()=>[e(u,{class:"stat-card"},{default:a(()=>[s("div",oe,[e(c,{size:24},{default:a(()=>[e(h(Q))]),_:1})]),s("div",ne,[s("div",ce,n(i.value?.totalCreated||0),1),s("div",ie,n(t.$t("admin.totalTickets")),1)])]),_:1})]),_:1}),e(v,{xs:12,sm:6},{default:a(()=>[e(u,{class:"stat-card"},{default:a(()=>[s("div",re,[e(c,{size:24},{default:a(()=>[e(h(W))]),_:1})]),s("div",de,[s("div",ue,n(i.value?.totalOpen||0),1),s("div",_e,n(t.$t("admin.openTickets")),1)])]),_:1})]),_:1}),e(v,{xs:12,sm:6},{default:a(()=>[e(u,{class:"stat-card"},{default:a(()=>[s("div",pe,[e(c,{size:24},{default:a(()=>[e(h(Z))]),_:1})]),s("div",ve,[s("div",fe,n(i.value?.totalClosed||0),1),s("div",me,n(t.$t("admin.resolved")),1)])]),_:1})]),_:1}),e(v,{xs:12,sm:6},{default:a(()=>[e(u,{class:"stat-card"},{default:a(()=>[s("div",he,[e(c,{size:24},{default:a(()=>[e(h(ee))]),_:1})]),s("div",ge,[s("div",be,n(I(i.value?.averageResolutionTime)),1),s("div",ye,n(t.$t("admin.avgResolution")),1)])]),_:1})]),_:1})]),_:1}),e($,{gutter:20},{default:a(()=>[e(v,{xs:24,md:12},{default:a(()=>[e(u,{class:"chart-card"},{header:a(()=>[s("span",null,n(t.$t("admin.ticketsByStatus")),1)]),default:a(()=>[s("div",we,[s("div",ke,[(_(!0),m(D,null,N(L.value,(o,y)=>(_(),m("div",{key:y,class:"status-bar-item"},[s("div",Te,n(o.label),1),s("div",Ae,[s("div",{class:"bar-fill",style:P({width:o.percentage+"%",backgroundColor:o.color})},null,4)]),s("div",Re,n(o.value),1)]))),128))])])]),_:1})]),_:1}),e(v,{xs:24,md:12},{default:a(()=>[e(u,{class:"chart-card"},{header:a(()=>[s("span",null,n(t.$t("admin.ticketsByPriority")),1)]),default:a(()=>[s("div",$e,[s("div",Me,[(_(!0),m(D,null,N(U.value,(o,y)=>(_(),m("div",{key:y,class:"priority-item"},[s("div",{class:"priority-value",style:P({color:o.color})},n(o.value),5),s("div",Se,n(o.label),1),e(M,{type:o.type,size:"small",effect:"plain"},{default:a(()=>[p(n(o.percentage)+"%",1)]),_:2},1032,["type"])]))),128))])])]),_:1})]),_:1})]),_:1}),e(u,{class:"performance-card"},{header:a(()=>[s("div",ze,[l[1]||(l[1]=s("span",null,"Agent Performance",-1)),e(E,{modelValue:T.value,"onUpdate:modelValue":l[0]||(l[0]=o=>T.value=o),size:"small"},{default:a(()=>[e(b,{label:"Last 7 Days",value:"7d"}),e(b,{label:"Last 30 Days",value:"30d"}),e(b,{label:"This Month",value:"month"})]),_:1},8,["modelValue"])])]),default:a(()=>[B((_(),V(S,{data:A.value},{default:a(()=>[e(r,{prop:"agentName",label:"Agent","min-width":"150"},{default:a(({row:o})=>[s("div",Ce,[e(O,{size:32},{default:a(()=>[p(n(H(o.agentName)),1)]),_:2},1024),s("span",null,n(o.agentName),1)])]),_:1}),e(r,{prop:"teamName",label:"Team",width:"140"}),e(r,{prop:"resolvedTickets",label:"Resolved",width:"100",align:"center"}),e(r,{prop:"averageResponseTime",label:"Avg Response",width:"130",align:"center"},{default:a(({row:o})=>[p(n(o.averageResponseTime)+"m ",1)]),_:1}),e(r,{prop:"averageResolutionTime",label:"Avg Resolution",width:"130",align:"center"},{default:a(({row:o})=>[p(n(F(o.averageResolutionTime)),1)]),_:1}),e(r,{prop:"satisfactionScore",label:"Satisfaction",width:"150",align:"center"},{default:a(({row:o})=>[s("div",De,[e(X,{"model-value":o.satisfactionScore||0,disabled:"",max:5,size:"small"},null,8,["model-value"]),s("span",null,n((o.satisfactionScore||0).toFixed(1)),1)])]),_:1})]),_:1},8,["data"])),[[z,g.value]])]),_:1}),e(u,{class:"activity-card"},{header:a(()=>[...l[2]||(l[2]=[s("span",null,"Recent Activity (Audit Log)",-1)])]),default:a(()=>[B((_(),V(S,{data:R.value},{default:a(()=>[e(r,{prop:"timestamp",label:"Time",width:"180"},{default:a(({row:o})=>[p(n(h(ae)(o.timestamp,"datetime")),1)]),_:1}),e(r,{prop:"userName",label:"User",width:"150"}),e(r,{prop:"action",label:"Action",width:"150"},{default:a(({row:o})=>[e(M,{type:j(o.action),size:"small"},{default:a(()=>[p(n(q(o.action)),1)]),_:2},1032,["type"])]),_:1}),e(r,{prop:"resourceType",label:"Resource",width:"120"}),e(r,{prop:"details",label:"Details","min-width":"200"},{default:a(({row:o})=>[p(n(o.details),1)]),_:1})]),_:1},8,["data"])),[[z,g.value]])]),_:1})])}}}),Le=se(Ne,[["__scopeId","data-v-984a0e8d"]]);export{Le as default};
