import{d as G,k as J,l as K,r as f,n as C,o as Q,c as m,f as e,w as a,g as d,e as s,i as h,z as W,t as n,a0 as Y,a1 as Z,aF as ee,F as D,O as N,a4 as P,y as _,p as V,X as te,q as x,h as p}from"./index-C3uyuHtt.js";import{m as w}from"./index-BrCbebx6.js";import{f as ae}from"./helpers-BtQK9j-g.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./tickets-CV57FQXZ.js";const le={class:"analytics-view"},oe={class:"stat-icon primary"},ne={class:"stat-content"},ie={class:"stat-value"},ce={class:"stat-label"},re={class:"stat-icon warning"},de={class:"stat-content"},ue={class:"stat-value"},_e={class:"stat-label"},pe={class:"stat-icon success"},ve={class:"stat-content"},fe={class:"stat-value"},me={class:"stat-label"},he={class:"stat-icon info"},ge={class:"stat-content"},be={class:"stat-value"},ye={class:"stat-label"},we={class:"chart-placeholder"},ke={class:"status-bars"},Te={class:"bar-label"},Ae={class:"bar-container"},Re={class:"bar-value"},$e={class:"chart-placeholder"},ze={class:"priority-grid"},Me={class:"priority-label"},Se={class:"card-header"},Ce={class:"agent-info"},De={class:"satisfaction"},Ne=G({__name:"AnalyticsView",setup(Pe){const{t:k}=J(),B=K(),g=f(!1),T=f("30d"),c=f(null),A=f([]),R=f([]),L=C(()=>{if(!c.value)return[];const t=c.value.byStatus,l=c.value.totalCreated||1;return[{label:"New",value:t.new||0,percentage:(t.new||0)/l*100,color:"#909399"},{label:"In Progress",value:t.in_progress||0,percentage:(t.in_progress||0)/l*100,color:"#e6a23c"},{label:"Resolved",value:t.resolved||0,percentage:(t.resolved||0)/l*100,color:"#67c23a"},{label:"Closed",value:t.closed||0,percentage:(t.closed||0)/l*100,color:"#409eff"}]}),U=C(()=>{if(!c.value)return[];const t=c.value.totalCreated||1,l=c.value.byPriority||{low:0,medium:0,high:0,urgent:0};return[{label:"Low",value:l.low,percentage:Math.round(l.low/t*100),color:"#909399",type:"info"},{label:"Medium",value:l.medium,percentage:Math.round(l.medium/t*100),color:"#409eff",type:""},{label:"High",value:l.high,percentage:Math.round(l.high/t*100),color:"#e6a23c",type:"warning"},{label:"Urgent",value:l.urgent,percentage:Math.round(l.urgent/t*100),color:"#f56c6c",type:"danger"}]});function I(t){if(!t)return"0h";if(t<60)return`${t}m`;const l=Math.floor(t/60),i=t%60;return i>0?`${l}h ${i}m`:`${l}h`}function F(t){if(t<60)return`${t}m`;const l=Math.floor(t/60),i=t%60;return i>0?`${l}h ${i}m`:`${l}h`}function H(t){return t.split(" ").map(l=>l[0]).join("").toUpperCase().slice(0,2)}Q(async()=>{B.setBreadcrumbs([{label:k("nav.administration")},{label:k("nav.analytics")}]),g.value=!0;try{const[t,l,i]=await Promise.all([w.getTicketAnalytics(),w.getAgentPerformance(),w.getAuditLogs({page:1,pageSize:10})]);t.code===200&&(c.value=t.data),l.code===200&&(A.value=l.data),i.code===200&&(R.value=i.data.items)}finally{g.value=!1}});function O(t){return{create:"success",update:"warning",delete:"danger",login:"info",logout:"info"}[t]||""}function j(t){return t.charAt(0).toUpperCase()+t.slice(1)}return(t,l)=>{const i=d("el-icon"),u=d("el-card"),v=d("el-col"),$=d("el-row"),z=d("el-tag"),b=d("el-option"),q=d("el-select"),E=d("el-avatar"),r=d("el-table-column"),X=d("el-rate"),M=d("el-table"),S=te("loading");return p(),m("div",le,[e($,{gutter:20,class:"stats-row"},{default:a(()=>[e(v,{xs:12,sm:6},{default:a(()=>[e(u,{class:"stat-card"},{default:a(()=>[s("div",oe,[e(i,{size:24},{default:a(()=>[e(h(W))]),_:1})]),s("div",ne,[s("div",ie,n(c.value?.totalCreated||0),1),s("div",ce,n(t.$t("admin.totalTickets")),1)])]),_:1})]),_:1}),e(v,{xs:12,sm:6},{default:a(()=>[e(u,{class:"stat-card"},{default:a(()=>[s("div",re,[e(i,{size:24},{default:a(()=>[e(h(Y))]),_:1})]),s("div",de,[s("div",ue,n(c.value?.totalOpen||0),1),s("div",_e,n(t.$t("admin.openTickets")),1)])]),_:1})]),_:1}),e(v,{xs:12,sm:6},{default:a(()=>[e(u,{class:"stat-card"},{default:a(()=>[s("div",pe,[e(i,{size:24},{default:a(()=>[e(h(Z))]),_:1})]),s("div",ve,[s("div",fe,n(c.value?.totalClosed||0),1),s("div",me,n(t.$t("admin.resolved")),1)])]),_:1})]),_:1}),e(v,{xs:12,sm:6},{default:a(()=>[e(u,{class:"stat-card"},{default:a(()=>[s("div",he,[e(i,{size:24},{default:a(()=>[e(h(ee))]),_:1})]),s("div",ge,[s("div",be,n(I(c.value?.averageResolutionTime)),1),s("div",ye,n(t.$t("admin.avgResolution")),1)])]),_:1})]),_:1})]),_:1}),e($,{gutter:20},{default:a(()=>[e(v,{xs:24,md:12},{default:a(()=>[e(u,{class:"chart-card"},{header:a(()=>[s("span",null,n(t.$t("admin.ticketsByStatus")),1)]),default:a(()=>[s("div",we,[s("div",ke,[(p(!0),m(D,null,N(L.value,(o,y)=>(p(),m("div",{key:y,class:"status-bar-item"},[s("div",Te,n(o.label),1),s("div",Ae,[s("div",{class:"bar-fill",style:P({width:o.percentage+"%",backgroundColor:o.color})},null,4)]),s("div",Re,n(o.value),1)]))),128))])])]),_:1})]),_:1}),e(v,{xs:24,md:12},{default:a(()=>[e(u,{class:"chart-card"},{header:a(()=>[s("span",null,n(t.$t("admin.ticketsByPriority")),1)]),default:a(()=>[s("div",$e,[s("div",ze,[(p(!0),m(D,null,N(U.value,(o,y)=>(p(),m("div",{key:y,class:"priority-item"},[s("div",{class:"priority-value",style:P({color:o.color})},n(o.value),5),s("div",Me,n(o.label),1),e(z,{type:o.type,size:"small",effect:"plain"},{default:a(()=>[_(n(o.percentage)+"%",1)]),_:2},1032,["type"])]))),128))])])]),_:1})]),_:1})]),_:1}),e(u,{class:"performance-card"},{header:a(()=>[s("div",Se,[l[1]||(l[1]=s("span",null,"Agent Performance",-1)),e(q,{modelValue:T.value,"onUpdate:modelValue":l[0]||(l[0]=o=>T.value=o),size:"small"},{default:a(()=>[e(b,{label:"Last 7 Days",value:"7d"}),e(b,{label:"Last 30 Days",value:"30d"}),e(b,{label:"This Month",value:"month"})]),_:1},8,["modelValue"])])]),default:a(()=>[V((p(),x(M,{data:A.value},{default:a(()=>[e(r,{prop:"agentName",label:"Agent","min-width":"150"},{default:a(({row:o})=>[s("div",Ce,[e(E,{size:32},{default:a(()=>[_(n(H(o.agentName)),1)]),_:2},1024),s("span",null,n(o.agentName),1)])]),_:1}),e(r,{prop:"teamName",label:"Team",width:"140"}),e(r,{prop:"resolvedTickets",label:"Resolved",width:"100",align:"center"}),e(r,{prop:"averageResponseTime",label:"Avg Response",width:"130",align:"center"},{default:a(({row:o})=>[_(n(o.averageResponseTime)+"m ",1)]),_:1}),e(r,{prop:"averageResolutionTime",label:"Avg Resolution",width:"130",align:"center"},{default:a(({row:o})=>[_(n(F(o.averageResolutionTime)),1)]),_:1}),e(r,{prop:"satisfactionScore",label:"Satisfaction",width:"150",align:"center"},{default:a(({row:o})=>[s("div",De,[e(X,{"model-value":o.satisfactionScore||0,disabled:"",max:5,size:"small"},null,8,["model-value"]),s("span",null,n((o.satisfactionScore||0).toFixed(1)),1)])]),_:1})]),_:1},8,["data"])),[[S,g.value]])]),_:1}),e(u,{class:"activity-card"},{header:a(()=>[...l[2]||(l[2]=[s("span",null,"Recent Activity (Audit Log)",-1)])]),default:a(()=>[V((p(),x(M,{data:R.value},{default:a(()=>[e(r,{prop:"timestamp",label:"Time",width:"180"},{default:a(({row:o})=>[_(n(h(ae)(o.timestamp,"datetime")),1)]),_:1}),e(r,{prop:"userName",label:"User",width:"150"}),e(r,{prop:"action",label:"Action",width:"150"},{default:a(({row:o})=>[e(z,{type:O(o.action),size:"small"},{default:a(()=>[_(n(j(o.action)),1)]),_:2},1032,["type"])]),_:1}),e(r,{prop:"resourceType",label:"Resource",width:"120"}),e(r,{prop:"details",label:"Details","min-width":"200"},{default:a(({row:o})=>[_(n(o.details),1)]),_:1})]),_:1},8,["data"])),[[S,g.value]])]),_:1})])}}}),Ie=se(Ne,[["__scopeId","data-v-984a0e8d"]]);export{Ie as default};
