import{d as X,p as G,q as O,r as d,ab as Q,X as W,c as y,a as r,y as D,z as Y,b as e,t as a,w as l,e as n,o as u,F as P,l as q,h,j as Z,a9 as x,i as p,ac as ee,f as te,J as le,E as V}from"./index-VQiFdX3i.js";import{u as oe}from"./ticket-ivnL_edV.js";import{u as se}from"./knowledge-4A_8GbbY.js";import{e as ae}from"./helpers-BtQK9j-g.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";const re={class:"create-ticket-view"},ne={class:"page-header"},ce={class:"card-header"},de={class:"suggestion-list"},ue=["onClick"],pe={class:"priority-desc"},me={class:"priority-desc"},fe={class:"priority-desc"},ge={class:"priority-desc"},_e={class:"upload-text"},ye={class:"upload-tip"},he=X({__name:"CreateTicketView",setup(ke){const k=te(),{t:C}=G(),m=oe(),b=se(),B=O(),v=d(),L=d(),$=d(!1),I=d([]),i=Q({title:"",categoryId:"",priority:"medium",description:""}),M={title:[{required:!0,message:"Please enter a title",trigger:"blur"},{min:10,message:"Title must be at least 10 characters",trigger:"blur"}],categoryId:[{required:!0,message:"Please select a category",trigger:"change"}],priority:[{required:!0,message:"Please select a priority",trigger:"change"}],description:[{required:!0,message:"Please enter a description",trigger:"blur"},{min:20,message:"Description must be at least 20 characters",trigger:"blur"}]},S=d(m.categories),f=d(b.suggestedArticles),R=ae(async()=>{i.title.length>=5?(await b.fetchSuggestedArticles(i.title),f.value=b.suggestedArticles):f.value=[]},500);W(async()=>{B.setBreadcrumbs([{label:C("nav.dashboard"),path:"/"},{label:C("nav.submitTicket")}]),await m.fetchCategories(),S.value=m.categories});function N(t){k.push(`/knowledge/${t}`)}async function j(){v.value&&await v.value.validate(async t=>{if(t){$.value=!0;try{const s=await m.createTicket({title:i.title,categoryId:i.categoryId,priority:i.priority,description:i.description});s.success&&s.ticket?(V.success("Ticket submitted successfully!"),k.push(`/tickets/${s.ticket.id}`)):V.error(s.message||"Failed to submit ticket")}catch{V.error("An error occurred while submitting the ticket")}finally{$.value=!1}}})}function z(){k.back()}return(t,s)=>{const w=n("el-icon"),T=n("el-card"),U=n("el-input"),c=n("el-form-item"),E=n("el-option"),F=n("el-select"),g=n("el-tag"),_=n("el-radio"),H=n("el-radio-group"),J=n("el-upload"),A=n("el-button"),K=n("el-form");return u(),y("div",re,[r("div",ne,[r("h1",null,a(t.$t("tickets.submitTicket")),1),r("p",null,a(t.$t("tickets.submitDesc")),1)]),f.value.length>0?(u(),D(T,{key:0,class:"suggestions-card"},{header:l(()=>[r("div",ce,[e(w,null,{default:l(()=>[e(h(Z))]),_:1}),r("span",null,a(t.$t("tickets.suggestedArticles")),1)])]),default:l(()=>[r("div",de,[(u(!0),y(P,null,q(f.value,o=>(u(),y("div",{key:o.id,class:"suggestion-item",onClick:be=>N(o.id)},[e(w,null,{default:l(()=>[e(h(le))]),_:1}),r("span",null,a(o.title),1)],8,ue))),128))])]),_:1})):Y("",!0),e(T,{class:"form-card"},{default:l(()=>[e(K,{ref_key:"formRef",ref:v,model:i,rules:M,"label-position":"top",onSubmit:x(j,["prevent"])},{default:l(()=>[e(c,{label:t.$t("common.title"),prop:"title"},{default:l(()=>[e(U,{modelValue:i.title,"onUpdate:modelValue":s[0]||(s[0]=o=>i.title=o),placeholder:t.$t("tickets.titlePlaceholder"),maxlength:"200","show-word-limit":"",onInput:h(R)},null,8,["modelValue","placeholder","onInput"])]),_:1},8,["label"]),e(c,{label:t.$t("common.category"),prop:"categoryId"},{default:l(()=>[e(F,{modelValue:i.categoryId,"onUpdate:modelValue":s[1]||(s[1]=o=>i.categoryId=o),placeholder:t.$t("tickets.selectCategory"),style:{width:"100%"}},{default:l(()=>[(u(!0),y(P,null,q(S.value,o=>(u(),D(E,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),e(c,{label:t.$t("common.priority"),prop:"priority"},{default:l(()=>[e(H,{modelValue:i.priority,"onUpdate:modelValue":s[2]||(s[2]=o=>i.priority=o)},{default:l(()=>[e(_,{value:"low"},{default:l(()=>[e(g,{type:"info",effect:"plain"},{default:l(()=>[p(a(t.$t("tickets.priorityLow")),1)]),_:1}),r("span",pe,a(t.$t("tickets.priorityLowDesc")),1)]),_:1}),e(_,{value:"medium"},{default:l(()=>[e(g,{effect:"plain"},{default:l(()=>[p(a(t.$t("tickets.priorityMedium")),1)]),_:1}),r("span",me,a(t.$t("tickets.priorityMediumDesc")),1)]),_:1}),e(_,{value:"high"},{default:l(()=>[e(g,{type:"warning",effect:"plain"},{default:l(()=>[p(a(t.$t("tickets.priorityHigh")),1)]),_:1}),r("span",fe,a(t.$t("tickets.priorityHighDesc")),1)]),_:1}),e(_,{value:"urgent"},{default:l(()=>[e(g,{type:"danger",effect:"plain"},{default:l(()=>[p(a(t.$t("tickets.priorityUrgent")),1)]),_:1}),r("span",ge,a(t.$t("tickets.priorityUrgentDesc")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),e(c,{label:t.$t("common.description"),prop:"description"},{default:l(()=>[e(U,{modelValue:i.description,"onUpdate:modelValue":s[3]||(s[3]=o=>i.description=o),type:"textarea",rows:6,placeholder:t.$t("tickets.descriptionPlaceholder"),maxlength:"5000","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(c,{label:t.$t("tickets.attachments")},{default:l(()=>[e(J,{ref_key:"uploadRef",ref:L,"file-list":I.value,"onUpdate:fileList":s[4]||(s[4]=o=>I.value=o),class:"upload-area",drag:"",multiple:"","auto-upload":!1,limit:5,accept:".jpg,.jpeg,.png,.gif,.pdf,.doc,.docx,.txt,.log"},{tip:l(()=>[r("div",ye,a(t.$t("tickets.uploadTip")),1)]),default:l(()=>[e(w,{class:"upload-icon"},{default:l(()=>[e(h(ee))]),_:1}),r("div",_e,a(t.$t("tickets.uploadText")),1)]),_:1},8,["file-list"])]),_:1},8,["label"]),e(c,null,{default:l(()=>[e(A,{type:"primary","native-type":"submit",size:"large",loading:$.value},{default:l(()=>[p(a(t.$t("common.submit")),1)]),_:1},8,["loading"]),e(A,{size:"large",onClick:z},{default:l(()=>[p(a(t.$t("common.cancel")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}}),Ie=ie(he,[["__scopeId","data-v-a2916316"]]);export{Ie as default};
