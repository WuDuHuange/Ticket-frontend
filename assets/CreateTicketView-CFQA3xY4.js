import{d as Q,k as J,l as O,r as u,ad as W,o as X,c as v,e as r,q as U,s as Y,f as e,t as s,w as l,g as n,G as P,Q as q,i as w,j as Z,ab as x,y as p,ae as ee,b as te,h as m,K as le,_ as oe,E as S}from"./index-C6r5wVjW.js";import{u as ae}from"./ticket-C_FNrsyi.js";import{u as se}from"./knowledge-DArXDcJQ.js";import{e as ie}from"./helpers-BtQK9j-g.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ne={class:"create-ticket-view"},ce={class:"page-header"},de={class:"card-header"},ue={class:"suggestion-list"},pe=["onClick"],me={class:"priority-desc"},fe={class:"priority-desc"},ge={class:"priority-desc"},_e={class:"priority-desc"},ye={class:"upload-text"},he={class:"upload-tip"},ke=Q({__name:"CreateTicketView",setup(be){const $=te(),{t:T}=J(),g=ae(),V=se(),B=O(),C=u(),L=u(),I=u(!1),_=u([]),i=W({title:"",categoryId:"",priority:"medium",description:""}),M={title:[{required:!0,message:"Please enter a title",trigger:"blur"},{min:10,message:"Title must be at least 10 characters",trigger:"blur"}],categoryId:[{required:!0,message:"Please select a category",trigger:"change"}],priority:[{required:!0,message:"Please select a priority",trigger:"change"}],description:[{required:!0,message:"Please enter a description",trigger:"blur"},{min:20,message:"Description must be at least 20 characters",trigger:"blur"}]},A=u(g.categories),y=u(V.suggestedArticles),R=ie(async()=>{i.title.length>=5?(await V.fetchSuggestedArticles(i.title),y.value=V.suggestedArticles):y.value=[]},500);X(async()=>{B.setBreadcrumbs([{label:T("nav.dashboard"),path:"/"},{label:T("nav.submitTicket")}]),await g.fetchCategories(),A.value=g.categories});function E(t){$.push(`/knowledge/${t}`)}async function F(){C.value&&await C.value.validate(async t=>{if(t){I.value=!0;try{const a=await g.createTicket({title:i.title,categoryId:i.categoryId,priority:i.priority,description:i.description});if(a.success&&a.ticket){if(_.value.length>0){for(const c of _.value)if(c.raw){const f=new FormData;f.append("file",c.raw);try{await oe.uploadAttachment(a.ticket.id,f)}catch(h){console.error("Failed to upload attachment:",h)}}}S.success("Ticket submitted successfully!"),$.push("/my-tickets")}else S.error(a.message||"Failed to submit ticket")}catch{S.error("An error occurred while submitting the ticket")}finally{I.value=!1}}})}function N(){$.back()}return(t,a)=>{const c=n("el-icon"),f=n("el-card"),h=n("el-input"),d=n("el-form-item"),j=n("el-option"),z=n("el-select"),k=n("el-tag"),b=n("el-radio"),H=n("el-radio-group"),K=n("el-upload"),D=n("el-button"),G=n("el-form");return m(),v("div",ne,[r("div",ce,[r("h1",null,s(t.$t("tickets.submitTicket")),1),r("p",null,s(t.$t("tickets.submitDesc")),1)]),y.value.length>0?(m(),U(f,{key:0,class:"suggestions-card"},{header:l(()=>[r("div",de,[e(c,null,{default:l(()=>[e(w(Z))]),_:1}),r("span",null,s(t.$t("tickets.suggestedArticles")),1)])]),default:l(()=>[r("div",ue,[(m(!0),v(P,null,q(y.value,o=>(m(),v("div",{key:o.id,class:"suggestion-item",onClick:ve=>E(o.id)},[e(c,null,{default:l(()=>[e(w(le))]),_:1}),r("span",null,s(o.title),1)],8,pe))),128))])]),_:1})):Y("",!0),e(f,{class:"form-card"},{default:l(()=>[e(G,{ref_key:"formRef",ref:C,model:i,rules:M,"label-position":"top",onSubmit:x(F,["prevent"])},{default:l(()=>[e(d,{label:t.$t("common.title"),prop:"title"},{default:l(()=>[e(h,{modelValue:i.title,"onUpdate:modelValue":a[0]||(a[0]=o=>i.title=o),placeholder:t.$t("tickets.titlePlaceholder"),maxlength:"200","show-word-limit":"",onInput:w(R)},null,8,["modelValue","placeholder","onInput"])]),_:1},8,["label"]),e(d,{label:t.$t("common.category"),prop:"categoryId"},{default:l(()=>[e(z,{modelValue:i.categoryId,"onUpdate:modelValue":a[1]||(a[1]=o=>i.categoryId=o),placeholder:t.$t("tickets.selectCategory"),style:{width:"100%"}},{default:l(()=>[(m(!0),v(P,null,q(A.value,o=>(m(),U(j,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),e(d,{label:t.$t("common.priority"),prop:"priority"},{default:l(()=>[e(H,{modelValue:i.priority,"onUpdate:modelValue":a[2]||(a[2]=o=>i.priority=o)},{default:l(()=>[e(b,{value:"low"},{default:l(()=>[e(k,{type:"info",effect:"plain"},{default:l(()=>[p(s(t.$t("tickets.priorityLow")),1)]),_:1}),r("span",me,s(t.$t("tickets.priorityLowDesc")),1)]),_:1}),e(b,{value:"medium"},{default:l(()=>[e(k,{effect:"plain"},{default:l(()=>[p(s(t.$t("tickets.priorityMedium")),1)]),_:1}),r("span",fe,s(t.$t("tickets.priorityMediumDesc")),1)]),_:1}),e(b,{value:"high"},{default:l(()=>[e(k,{type:"warning",effect:"plain"},{default:l(()=>[p(s(t.$t("tickets.priorityHigh")),1)]),_:1}),r("span",ge,s(t.$t("tickets.priorityHighDesc")),1)]),_:1}),e(b,{value:"urgent"},{default:l(()=>[e(k,{type:"danger",effect:"plain"},{default:l(()=>[p(s(t.$t("tickets.priorityUrgent")),1)]),_:1}),r("span",_e,s(t.$t("tickets.priorityUrgentDesc")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),e(d,{label:t.$t("common.description"),prop:"description"},{default:l(()=>[e(h,{modelValue:i.description,"onUpdate:modelValue":a[3]||(a[3]=o=>i.description=o),type:"textarea",rows:6,placeholder:t.$t("tickets.descriptionPlaceholder"),maxlength:"5000","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(d,{label:t.$t("tickets.attachments")},{default:l(()=>[e(K,{ref_key:"uploadRef",ref:L,"file-list":_.value,"onUpdate:fileList":a[4]||(a[4]=o=>_.value=o),class:"upload-area",drag:"",multiple:"","auto-upload":!1,limit:5,accept:".jpg,.jpeg,.png,.gif,.pdf,.doc,.docx,.txt,.log"},{tip:l(()=>[r("div",he,s(t.$t("tickets.uploadTip")),1)]),default:l(()=>[e(c,{class:"upload-icon"},{default:l(()=>[e(w(ee))]),_:1}),r("div",ye,s(t.$t("tickets.uploadText")),1)]),_:1},8,["file-list"])]),_:1},8,["label"]),e(d,null,{default:l(()=>[e(D,{type:"primary","native-type":"submit",size:"large",loading:I.value},{default:l(()=>[p(s(t.$t("common.submit")),1)]),_:1},8,["loading"]),e(D,{size:"large",onClick:N},{default:l(()=>[p(s(t.$t("common.cancel")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}}),Se=re(ke,[["__scopeId","data-v-130bcc06"]]);export{Se as default};
