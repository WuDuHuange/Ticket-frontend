import{d as Q,k as J,l as K,r as f,n as S,o as W,aM as C,aN as X,c as m,f as e,w as t,g as d,e as s,i as h,z as Y,t as n,a4 as Z,a5 as ee,aO as ae,G as N,Q as D,a8 as P,y as _,p as V,$ as te,q as x,h as p}from"./index-wT8oNPsL.js";import{f as se}from"./helpers-BtQK9j-g.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";const oe={class:"analytics-view"},ne={class:"stat-icon primary"},ce={class:"stat-content"},ie={class:"stat-value"},re={class:"stat-label"},de={class:"stat-icon warning"},ue={class:"stat-content"},_e={class:"stat-value"},pe={class:"stat-label"},ve={class:"stat-icon success"},fe={class:"stat-content"},me={class:"stat-value"},he={class:"stat-label"},ge={class:"stat-icon info"},ye={class:"stat-content"},be={class:"stat-value"},we={class:"stat-label"},Ae={class:"chart-placeholder"},ke={class:"status-bars"},Te={class:"bar-label"},Re={class:"bar-container"},$e={class:"bar-value"},Me={class:"chart-placeholder"},ze={class:"priority-grid"},Se={class:"priority-label"},Ce={class:"card-header"},Ne={class:"agent-info"},De={class:"satisfaction"},Pe=Q({__name:"AnalyticsView",setup(Ve){const{t:w}=J(),B=K(),g=f(!1),A=f("30d"),i=f(null),k=f([]),T=f([]),L=S(()=>{if(!i.value)return[];const a=i.value.byStatus,l=i.value.totalCreated||1;return[{label:"New",value:a.new||0,percentage:(a.new||0)/l*100,color:"#909399"},{label:"In Progress",value:a.in_progress||0,percentage:(a.in_progress||0)/l*100,color:"#e6a23c"},{label:"Resolved",value:a.resolved||0,percentage:(a.resolved||0)/l*100,color:"#67c23a"},{label:"Closed",value:a.closed||0,percentage:(a.closed||0)/l*100,color:"#409eff"}]}),U=S(()=>{if(!i.value)return[];const a=i.value.totalCreated||1,l=i.value.byPriority||{low:0,medium:0,high:0,urgent:0};return[{label:"Low",value:l.low,percentage:Math.round(l.low/a*100),color:"#909399",type:"info"},{label:"Medium",value:l.medium,percentage:Math.round(l.medium/a*100),color:"#409eff",type:""},{label:"High",value:l.high,percentage:Math.round(l.high/a*100),color:"#e6a23c",type:"warning"},{label:"Urgent",value:l.urgent,percentage:Math.round(l.urgent/a*100),color:"#f56c6c",type:"danger"}]});function I(a){if(!a)return"0h";if(a<60)return`${a}m`;const l=Math.floor(a/60),c=a%60;return c>0?`${l}h ${c}m`:`${l}h`}function F(a){if(a<60)return`${a}m`;const l=Math.floor(a/60),c=a%60;return c>0?`${l}h ${c}m`:`${l}h`}function O(a){return a.split(" ").map(l=>l[0]).join("").toUpperCase().slice(0,2)}W(async()=>{B.setBreadcrumbs([{label:w("nav.administration")},{label:w("nav.analytics")}]),g.value=!0;try{const[a,l,c]=await Promise.all([C.getTicketAnalytics({}).catch(()=>({code:500,data:null})),C.getAgentPerformance({}).catch(()=>({code:500,data:[]})),X.getAuditLogs({page:1,pageSize:10}).catch(()=>({code:500,data:{items:[]}}))]);a.code===200&&a.data&&(i.value=a.data),l.code===200&&l.data&&(k.value=l.data),c.code===200&&c.data&&(T.value=c.data.items)}finally{g.value=!1}});function j(a){return{create:"success",update:"warning",delete:"danger",login:"info",logout:"info"}[a]||""}function q(a){return a.charAt(0).toUpperCase()+a.slice(1)}return(a,l)=>{const c=d("el-icon"),u=d("el-card"),v=d("el-col"),R=d("el-row"),$=d("el-tag"),y=d("el-option"),E=d("el-select"),G=d("el-avatar"),r=d("el-table-column"),H=d("el-rate"),M=d("el-table"),z=te("loading");return p(),m("div",oe,[e(R,{gutter:20,class:"stats-row"},{default:t(()=>[e(v,{xs:12,sm:6},{default:t(()=>[e(u,{class:"stat-card"},{default:t(()=>[s("div",ne,[e(c,{size:24},{default:t(()=>[e(h(Y))]),_:1})]),s("div",ce,[s("div",ie,n(i.value?.totalCreated||0),1),s("div",re,n(a.$t("admin.totalTickets")),1)])]),_:1})]),_:1}),e(v,{xs:12,sm:6},{default:t(()=>[e(u,{class:"stat-card"},{default:t(()=>[s("div",de,[e(c,{size:24},{default:t(()=>[e(h(Z))]),_:1})]),s("div",ue,[s("div",_e,n(i.value?.totalOpen||0),1),s("div",pe,n(a.$t("admin.openTickets")),1)])]),_:1})]),_:1}),e(v,{xs:12,sm:6},{default:t(()=>[e(u,{class:"stat-card"},{default:t(()=>[s("div",ve,[e(c,{size:24},{default:t(()=>[e(h(ee))]),_:1})]),s("div",fe,[s("div",me,n(i.value?.totalClosed||0),1),s("div",he,n(a.$t("admin.resolved")),1)])]),_:1})]),_:1}),e(v,{xs:12,sm:6},{default:t(()=>[e(u,{class:"stat-card"},{default:t(()=>[s("div",ge,[e(c,{size:24},{default:t(()=>[e(h(ae))]),_:1})]),s("div",ye,[s("div",be,n(I(i.value?.averageResolutionTime)),1),s("div",we,n(a.$t("admin.avgResolution")),1)])]),_:1})]),_:1})]),_:1}),e(R,{gutter:20},{default:t(()=>[e(v,{xs:24,md:12},{default:t(()=>[e(u,{class:"chart-card"},{header:t(()=>[s("span",null,n(a.$t("admin.ticketsByStatus")),1)]),default:t(()=>[s("div",Ae,[s("div",ke,[(p(!0),m(N,null,D(L.value,(o,b)=>(p(),m("div",{key:b,class:"status-bar-item"},[s("div",Te,n(o.label),1),s("div",Re,[s("div",{class:"bar-fill",style:P({width:o.percentage+"%",backgroundColor:o.color})},null,4)]),s("div",$e,n(o.value),1)]))),128))])])]),_:1})]),_:1}),e(v,{xs:24,md:12},{default:t(()=>[e(u,{class:"chart-card"},{header:t(()=>[s("span",null,n(a.$t("admin.ticketsByPriority")),1)]),default:t(()=>[s("div",Me,[s("div",ze,[(p(!0),m(N,null,D(U.value,(o,b)=>(p(),m("div",{key:b,class:"priority-item"},[s("div",{class:"priority-value",style:P({color:o.color})},n(o.value),5),s("div",Se,n(o.label),1),e($,{type:o.type,size:"small",effect:"plain"},{default:t(()=>[_(n(o.percentage)+"%",1)]),_:2},1032,["type"])]))),128))])])]),_:1})]),_:1})]),_:1}),e(u,{class:"performance-card"},{header:t(()=>[s("div",Ce,[l[1]||(l[1]=s("span",null,"Agent Performance",-1)),e(E,{modelValue:A.value,"onUpdate:modelValue":l[0]||(l[0]=o=>A.value=o),size:"small"},{default:t(()=>[e(y,{label:"Last 7 Days",value:"7d"}),e(y,{label:"Last 30 Days",value:"30d"}),e(y,{label:"This Month",value:"month"})]),_:1},8,["modelValue"])])]),default:t(()=>[V((p(),x(M,{data:k.value},{default:t(()=>[e(r,{prop:"agentName",label:"Agent","min-width":"150"},{default:t(({row:o})=>[s("div",Ne,[e(G,{size:32},{default:t(()=>[_(n(O(o.agentName)),1)]),_:2},1024),s("span",null,n(o.agentName),1)])]),_:1}),e(r,{prop:"teamName",label:"Team",width:"140"}),e(r,{prop:"resolvedTickets",label:"Resolved",width:"100",align:"center"}),e(r,{prop:"averageResponseTime",label:"Avg Response",width:"130",align:"center"},{default:t(({row:o})=>[_(n(o.averageResponseTime)+"m ",1)]),_:1}),e(r,{prop:"averageResolutionTime",label:"Avg Resolution",width:"130",align:"center"},{default:t(({row:o})=>[_(n(F(o.averageResolutionTime)),1)]),_:1}),e(r,{prop:"satisfactionScore",label:"Satisfaction",width:"150",align:"center"},{default:t(({row:o})=>[s("div",De,[e(H,{"model-value":o.satisfactionScore||0,disabled:"",max:5,size:"small"},null,8,["model-value"]),s("span",null,n((o.satisfactionScore||0).toFixed(1)),1)])]),_:1})]),_:1},8,["data"])),[[z,g.value]])]),_:1}),e(u,{class:"activity-card"},{header:t(()=>[...l[2]||(l[2]=[s("span",null,"Recent Activity (Audit Log)",-1)])]),default:t(()=>[V((p(),x(M,{data:T.value},{default:t(()=>[e(r,{prop:"timestamp",label:"Time",width:"180"},{default:t(({row:o})=>[_(n(h(se)(o.timestamp,"datetime")),1)]),_:1}),e(r,{prop:"userName",label:"User",width:"150"}),e(r,{prop:"action",label:"Action",width:"150"},{default:t(({row:o})=>[e($,{type:j(o.action),size:"small"},{default:t(()=>[_(n(q(o.action)),1)]),_:2},1032,["type"])]),_:1}),e(r,{prop:"resourceType",label:"Resource",width:"120"}),e(r,{prop:"details",label:"Details","min-width":"200"},{default:t(({row:o})=>[_(n(o.details),1)]),_:1})]),_:1},8,["data"])),[[z,g.value]])]),_:1})])}}}),Ue=le(Pe,[["__scopeId","data-v-2ad8197f"]]);export{Ue as default};
