import{d as ne,k as oe,u as ie,l as ce,n as z,r as A,o as de,a as ue,Z as re,p as me,$ as _e,c as _,q as k,s as v,G as B,e as n,f as e,w as t,g as c,t as s,i as r,y as o,aa as pe,V as fe,H as ve,a4 as ke,J as he,Q as D,ab as ge,E as w,b as ye,h as u,K as be,S as we,ac as $e}from"./index-DaxlKADp.js";import{u as Ce}from"./ticket-Dn7lwD9h.js";import{g as G,f as N,a as Se,b as Te,c as Be,d as Ne}from"./helpers-BtQK9j-g.js";import{_ as Ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ie={class:"ticket-detail-view"},ze={class:"page-header"},Ae={class:"header-left"},De={key:0,class:"header-right"},Ue={class:"ticket-title"},Me={class:"ticket-meta"},Pe={class:"ticket-description"},qe={key:0,class:"attachments-section"},Ee={class:"attachment-list"},Fe=["href"],He={class:"attachment-size"},Re={class:"card-header"},Ge={class:"comments-list"},Le={class:"comment-header"},je={class:"comment-author"},Je={class:"author-name"},Ke={class:"comment-time"},Qe={class:"comment-content"},Ze={class:"add-comment"},Oe={class:"comment-actions"},We={class:"history-item"},Xe={class:"history-change"},Ye={class:"history-by"},xe={key:0,class:"history-comment"},et=ne({__name:"TicketDetailView",setup(tt){const U=ue(),L=ye(),{t:d}=oe(),h=Ce(),j=ie(),M=ce(),P=z(()=>h.loading),l=z(()=>h.currentTicket),q=z(()=>j.isStaff),g=A(""),$=A(!1),V=A(!1);function C(a){return{new:d("tickets.statusNew"),assigned:d("tickets.statusAssigned"),in_progress:d("tickets.statusInProgress"),pending_user:d("tickets.statusPendingUser"),resolved:d("tickets.statusResolved"),closed:d("tickets.statusClosed")}[a]||a}de(async()=>{const a=U.params.id;await h.fetchTicketById(a),l.value&&M.setBreadcrumbs([{label:d("nav.dashboard"),path:"/"},{label:d("nav.tickets"),path:"/my-tickets"},{label:l.value.id}])}),re(()=>U.params.id,async a=>{a&&(await h.fetchTicketById(a),l.value&&M.setBreadcrumbs([{label:d("nav.dashboard"),path:"/"},{label:d("nav.tickets"),path:"/my-tickets"},{label:l.value.id}]))});function E(){L.back()}function J(a){return a.split(" ").map(m=>m[0]).join("").toUpperCase().slice(0,2)}async function K(a){if(l.value)try{const{value:m}=await $e.prompt(d("tickets.statusChangeComment"),d("tickets.changeStatus"),{confirmButtonText:d("common.confirm"),cancelButtonText:d("common.cancel"),inputType:"textarea"}),p=await h.updateTicketStatus(l.value.id,a,m);p.success?w.success(d("tickets.statusUpdated")):w.error(p.message||d("errors.operationFailed"))}catch{}}async function F(){if(!l.value||!g.value.trim()){w.warning(d("tickets.enterComment"));return}V.value=!0;try{const a=await h.addComment(l.value.id,g.value,$.value);a.success?(w.success(d("tickets.commentAdded")),g.value="",$.value=!1):w.error(a.message||d("errors.operationFailed"))}finally{V.value=!1}}return(a,m)=>{const p=c("el-icon"),S=c("el-button"),y=c("el-tag"),b=c("el-dropdown-item"),Q=c("el-dropdown-menu"),Z=c("el-dropdown"),H=c("el-divider"),T=c("el-card"),O=c("el-avatar"),I=c("el-empty"),W=c("el-input"),X=c("el-form-item"),Y=c("el-checkbox"),x=c("el-form"),R=c("el-col"),f=c("el-descriptions-item"),ee=c("el-descriptions"),te=c("el-timeline-item"),ae=c("el-timeline"),se=c("el-row"),le=_e("loading");return me((u(),_("div",Ie,[l.value?(u(),_(B,{key:0},[n("div",ze,[n("div",Ae,[e(S,{text:"",onClick:E},{default:t(()=>[e(p,null,{default:t(()=>[e(r(pe))]),_:1}),o(" "+s(a.$t("common.back")),1)]),_:1}),n("h1",null,s(l.value.id),1),e(y,{type:r(G)(l.value.status),size:"large"},{default:t(()=>[o(s(C(l.value.status)),1)]),_:1},8,["type"]),l.value.slaBreached?(u(),k(y,{key:0,type:"danger",size:"large"},{default:t(()=>[...m[2]||(m[2]=[o(" SLA ",-1)])]),_:1})):v("",!0)]),q.value?(u(),_("div",De,[e(Z,{onCommand:K},{dropdown:t(()=>[e(Q,null,{default:t(()=>[e(b,{command:"assigned",disabled:l.value.status==="assigned"},{default:t(()=>[o(s(a.$t("tickets.assignToMe")),1)]),_:1},8,["disabled"]),e(b,{command:"in_progress",disabled:l.value.status==="in_progress"},{default:t(()=>[o(s(a.$t("tickets.statusInProgress")),1)]),_:1},8,["disabled"]),e(b,{command:"pending_user",disabled:l.value.status==="pending_user"},{default:t(()=>[o(s(a.$t("tickets.statusPendingUser")),1)]),_:1},8,["disabled"]),e(b,{command:"resolved",disabled:l.value.status==="resolved"},{default:t(()=>[o(s(a.$t("tickets.markResolved")),1)]),_:1},8,["disabled"]),e(b,{command:"closed",disabled:l.value.status==="closed"},{default:t(()=>[o(s(a.$t("tickets.closeTicket")),1)]),_:1},8,["disabled"])]),_:1})]),default:t(()=>[e(S,{type:"primary"},{default:t(()=>[o(s(a.$t("tickets.changeStatus"))+" ",1),e(p,{class:"el-icon--right"},{default:t(()=>[e(r(fe))]),_:1})]),_:1})]),_:1})])):v("",!0)]),e(se,{gutter:24},{default:t(()=>[e(R,{xs:24,lg:16},{default:t(()=>[e(T,{class:"info-card"},{default:t(()=>[n("h2",Ue,s(l.value.title),1),n("div",Me,[n("span",null,[e(p,null,{default:t(()=>[e(r(ve))]),_:1}),o(" "+s(l.value.requesterName),1)]),n("span",null,[e(p,null,{default:t(()=>[e(r(ke))]),_:1}),o(" "+s(r(N)(l.value.createdAt,"datetime")),1)]),n("span",null,[e(p,null,{default:t(()=>[e(r(he))]),_:1}),o(" "+s(l.value.category?.name||"General"),1)])]),e(H),n("div",Pe,[n("h3",null,s(a.$t("common.description")),1),n("p",null,s(l.value.description),1)]),l.value.attachments&&l.value.attachments.length>0?(u(),_("div",qe,[n("h3",null,s(a.$t("tickets.attachments")),1),n("div",Ee,[(u(!0),_(B,null,D(l.value.attachments,i=>(u(),_("a",{key:i.id,class:"attachment-item",href:i.url,target:"_blank"},[e(p,null,{default:t(()=>[e(r(be))]),_:1}),n("span",null,s(i.filename),1),n("span",He,s(r(Be)(i.fileSize)),1)],8,Fe))),128))])])):v("",!0)]),_:1}),e(T,{class:"comments-card"},{header:t(()=>[n("div",Re,[n("span",null,s(a.$t("tickets.comments"))+" ("+s(l.value.comments?.length||0)+")",1)])]),default:t(()=>[n("div",Ge,[(u(!0),_(B,null,D(l.value.comments,i=>(u(),_("div",{key:i.id,class:we(["comment-item",{internal:i.isInternal}])},[n("div",Le,[n("div",je,[e(O,{size:32},{default:t(()=>[o(s(J(i.authorName)),1)]),_:2},1024),n("span",Je,s(i.authorName),1),i.isInternal?(u(),k(y,{key:0,type:"warning",size:"small"},{default:t(()=>[o(s(a.$t("tickets.internalNote")),1)]),_:1})):v("",!0)]),n("span",Ke,s(r(Ne)(i.createdAt)),1)]),n("div",Qe,s(i.content),1)],2))),128)),l.value.comments?.length?v("",!0):(u(),k(I,{key:0,description:a.$t("tickets.noComments")},null,8,["description"]))]),n("div",Ze,[e(H),e(x,{onSubmit:ge(F,["prevent"])},{default:t(()=>[e(X,null,{default:t(()=>[e(W,{modelValue:g.value,"onUpdate:modelValue":m[0]||(m[0]=i=>g.value=i),type:"textarea",rows:3,placeholder:a.$t("tickets.addCommentPlaceholder")},null,8,["modelValue","placeholder"])]),_:1}),n("div",Oe,[q.value?(u(),k(Y,{key:0,modelValue:$.value,"onUpdate:modelValue":m[1]||(m[1]=i=>$.value=i)},{default:t(()=>[o(s(a.$t("tickets.internalNoteDesc")),1)]),_:1},8,["modelValue"])):v("",!0),e(S,{type:"primary",onClick:F,loading:V.value},{default:t(()=>[o(s(a.$t("tickets.addComment")),1)]),_:1},8,["loading"])])]),_:1})])]),_:1})]),_:1}),e(R,{xs:24,lg:8},{default:t(()=>[e(T,{class:"details-card"},{header:t(()=>[n("span",null,s(a.$t("tickets.ticketDetails")),1)]),default:t(()=>[e(ee,{column:1,border:""},{default:t(()=>[e(f,{label:a.$t("common.status")},{default:t(()=>[e(y,{type:r(G)(l.value.status)},{default:t(()=>[o(s(C(l.value.status)),1)]),_:1},8,["type"])]),_:1},8,["label"]),e(f,{label:a.$t("common.priority")},{default:t(()=>[e(y,{type:r(Se)(l.value.priority),effect:"plain"},{default:t(()=>[o(s(r(Te)(l.value.priority)),1)]),_:1},8,["type"])]),_:1},8,["label"]),e(f,{label:a.$t("common.category")},{default:t(()=>[o(s(l.value.category?.name||"General"),1)]),_:1},8,["label"]),e(f,{label:a.$t("tickets.channel")},{default:t(()=>[o(s(l.value.channel),1)]),_:1},8,["label"]),e(f,{label:a.$t("tickets.requester")},{default:t(()=>[o(s(l.value.requesterName),1)]),_:1},8,["label"]),e(f,{label:a.$t("common.email")},{default:t(()=>[o(s(l.value.requesterEmail),1)]),_:1},8,["label"]),e(f,{label:a.$t("tickets.assignee")},{default:t(()=>[o(s(l.value.assigneeName||a.$t("tickets.unassigned")),1)]),_:1},8,["label"]),e(f,{label:a.$t("common.created")},{default:t(()=>[o(s(r(N)(l.value.createdAt,"datetime")),1)]),_:1},8,["label"]),e(f,{label:a.$t("common.updated")},{default:t(()=>[o(s(r(N)(l.value.updatedAt,"datetime")),1)]),_:1},8,["label"])]),_:1})]),_:1}),e(T,{class:"history-card"},{header:t(()=>[n("span",null,s(a.$t("tickets.statusHistory")),1)]),default:t(()=>[e(ae,null,{default:t(()=>[(u(!0),_(B,null,D(l.value.statusHistory,i=>(u(),k(te,{key:i.id,timestamp:r(N)(i.changedAt,"datetime"),placement:"top"},{default:t(()=>[n("div",We,[n("span",Xe,s(C(i.previousStatus))+" â†’ "+s(C(i.newStatus)),1),n("span",Ye,"by "+s(i.changedBy),1),i.comment?(u(),_("p",xe,s(i.comment),1)):v("",!0)])]),_:2},1032,["timestamp"]))),128))]),_:1}),l.value.statusHistory?.length?v("",!0):(u(),k(I,{key:0,description:a.$t("tickets.noHistory"),"image-size":60},null,8,["description"]))]),_:1})]),_:1})]),_:1})],64)):P.value?v("",!0):(u(),k(I,{key:1,description:a.$t("tickets.ticketNotFound")},{default:t(()=>[e(S,{type:"primary",onClick:E},{default:t(()=>[o(s(a.$t("knowledge.goBack")),1)]),_:1})]),_:1},8,["description"]))])),[[le,P.value]])}}}),ot=Ve(et,[["__scopeId","data-v-d0ef1018"]]);export{ot as default};
