import{d as Ne,k as Ae,u as Me,l as Se,r as O,o as Ie,n as Te,p as f,a as Ue,c as h,f as e,w as t,g as i,q as M,e as _,s as je,i as s,m as xe,v as Oe,t as n,x as m,y as g,z as Re,A as d,B,C as Ve,D as ze,F as Pe,G as qe,H as Be,I as De,J as R,K as D,L as Fe,M as Ke,N as Le,O as Ee,P as Qe,Q as F,R as We,S as Ge,T as K,U as He,V as L,W as E,X as Q,Y as Je,Z as Xe,_ as Ye,b as Ze,h as c}from"./index-Bo1QE9TC.js";import{_ as et}from"./_plugin-vue_export-helper-DlAUqK2U.js";const tt={class:"main-layout"},at={class:"logo-container"},nt={class:"sidebar-footer"},ot={class:"header-left"},lt={class:"header-right"},st={class:"notification-panel"},it={class:"notification-header"},dt={class:"notification-title"},ut={key:0,class:"notification-empty"},ct={key:1,class:"notification-list"},rt=["onClick"],_t={class:"notification-content"},ft={class:"notification-text"},mt={class:"notification-time"},pt={class:"user-info"},vt={class:"user-name"},ht=Ne({__name:"MainLayout",setup(gt){const{t:b}=Ae(),W=Ue(),w=Ze(),p=Me(),S=Se(),$=O(""),k=O([]),v=O(0);let C=null;async function I(){try{const a=await M.getNotifications({page:1,pageSize:10});a&&a.data&&a.data.items&&(k.value=a.data.items.map(l=>({id:l.id,type:H(l.type),title:l.title,message:l.message,time:new Date(l.createdAt),read:l.isRead,relatedObjectType:l.relatedObjectType,relatedObjectId:l.relatedObjectId,link:l.relatedObjectType==="ticket"&&l.relatedObjectId?`/tickets/${l.relatedObjectId}`:void 0})))}catch(a){console.error("Failed to fetch notifications:",a)}}async function T(){try{const a=await M.getUnreadCount();if(a&&a.data&&typeof a.data.count=="number"){const l=a.data.count;l>v.value&&await I(),v.value=l}}catch(a){console.error("Failed to fetch unread count:",a)}}async function G(){await I(),await T()}function H(a){return a.includes("ticket")?"ticket":a.includes("sla")||a==="system"?"system":"info"}function J(a){switch(a){case"ticket":return B;case"system":return F;default:return Q}}function X(a){const o=new Date().getTime()-a.getTime(),u=Math.floor(o/(1e3*60)),y=Math.floor(o/(1e3*60*60)),j=Math.floor(o/(1e3*60*60*24));return u<1?b("common.justNow"):u<60?b("common.minutesAgo",{n:u}):y<24?b("common.hoursAgo",{n:y}):b("common.daysAgo",{n:j})}async function Y(a){if(!a.read)try{await M.markAsRead(a.id),a.read=!0,v.value=Math.max(0,v.value-1)}catch(l){console.error("Failed to mark notification as read:",l)}a.link&&w.push(a.link)}async function Z(){try{await M.markAllAsRead(),k.value.forEach(a=>a.read=!0),v.value=0}catch(a){console.error("Failed to mark all notifications as read:",a)}}function ee(){I(),T(),C=window.setInterval(()=>{T()},3e4)}function te(){C&&(clearInterval(C),C=null)}Ie(()=>{p.isAuthenticated&&ee()}),Te(()=>{te()});const N=f(()=>S.sidebarCollapsed),ae=f(()=>N.value?"64px":"220px"),ne=f(()=>W.path),oe=f(()=>S.breadcrumbs),le=f(()=>p.userName||"User"),se=f(()=>p.userAvatar),ie=f(()=>(p.userName||"U").split(" ").map(l=>l[0]).join("").toUpperCase().slice(0,2)),U=f(()=>p.isStaff),V=f(()=>p.isManager),z=f(()=>p.isAdmin);function de(){S.toggleSidebar()}function ue(){$.value&&w.push({path:"/knowledge",query:{q:$.value}})}async function ce(a){switch(a){case"profile":w.push("/profile");break;case"logout":await p.logout(),w.push("/login");break}}return(a,l)=>{const o=i("el-icon"),u=i("el-menu-item"),y=i("el-divider"),j=i("el-sub-menu"),re=i("el-menu"),x=i("el-button"),_e=i("el-aside"),fe=i("el-breadcrumb-item"),me=i("el-breadcrumb"),pe=i("el-input"),ve=i("el-badge"),he=i("el-empty"),ge=i("el-popover"),ye=i("el-avatar"),P=i("el-dropdown-item"),ke=i("el-dropdown-menu"),be=i("el-dropdown"),we=i("el-header"),$e=i("router-view"),Ce=i("el-main"),q=i("el-container");return c(),h("div",tt,[e(q,{class:"layout-container"},{default:t(()=>[e(_e,{width:ae.value,class:"sidebar"},{default:t(()=>[_("div",at,[e(o,{size:28,class:"logo-icon"},{default:t(()=>[e(s(xe))]),_:1}),je(_("span",{class:"logo-text"},n(a.$t("header.title")),513),[[Oe,!N.value]])]),e(re,{"default-active":ne.value,class:"sidebar-menu",collapse:N.value,router:""},{default:t(()=>[e(u,{index:"/"},{title:t(()=>[d(n(a.$t("nav.dashboard")),1)]),default:t(()=>[e(o,null,{default:t(()=>[e(s(Re))]),_:1})]),_:1}),U.value?(c(),m(u,{key:0,index:"/tickets"},{title:t(()=>[d(n(a.$t("nav.allTickets")),1)]),default:t(()=>[e(o,null,{default:t(()=>[e(s(B))]),_:1})]),_:1})):g("",!0),U.value?(c(),m(u,{key:1,index:"/assigned-tickets"},{title:t(()=>[d(n(a.$t("nav.assignedTickets")),1)]),default:t(()=>[e(o,null,{default:t(()=>[e(s(Ve))]),_:1})]),_:1})):g("",!0),e(u,{index:"/my-tickets"},{title:t(()=>[d(n(a.$t("nav.myTickets")),1)]),default:t(()=>[e(o,null,{default:t(()=>[e(s(ze))]),_:1})]),_:1}),e(u,{index:"/tickets/create"},{title:t(()=>[d(n(a.$t("nav.submitTicket")),1)]),default:t(()=>[e(o,null,{default:t(()=>[e(s(Pe))]),_:1})]),_:1}),e(y),e(u,{index:"/knowledge"},{title:t(()=>[d(n(a.$t("nav.knowledgeBase")),1)]),default:t(()=>[e(o,null,{default:t(()=>[e(s(qe))]),_:1})]),_:1}),e(u,{index:"/faq"},{title:t(()=>[d(n(a.$t("nav.faq")),1)]),default:t(()=>[e(o,null,{default:t(()=>[e(s(Be))]),_:1})]),_:1}),U.value&&!V.value?(c(),m(u,{key:2,index:"/admin/articles"},{title:t(()=>[d(n(a.$t("nav.articleManagement")),1)]),default:t(()=>[e(o,null,{default:t(()=>[e(s(De))]),_:1})]),_:1})):g("",!0),V.value?(c(),h(R,{key:3},[e(y),e(j,{index:"/admin"},{title:t(()=>[e(o,null,{default:t(()=>[e(s(F))]),_:1}),_("span",null,n(a.$t("nav.administration")),1)]),default:t(()=>[z.value?(c(),m(u,{key:0,index:"/admin/users"},{default:t(()=>[e(o,null,{default:t(()=>[e(s(D))]),_:1}),d(" "+n(a.$t("nav.userManagement")),1)]),_:1})):g("",!0),e(u,{index:"/admin/teams"},{default:t(()=>[e(o,null,{default:t(()=>[e(s(Fe))]),_:1}),d(" "+n(a.$t("nav.teamManagement")),1)]),_:1}),e(u,{index:"/admin/categories"},{default:t(()=>[e(o,null,{default:t(()=>[e(s(Ke))]),_:1}),d(" "+n(a.$t("nav.categoryManagement")||"Category Management"),1)]),_:1}),e(u,{index:"/admin/articles"},{default:t(()=>[e(o,null,{default:t(()=>[e(s(Le))]),_:1}),d(" "+n(a.$t("nav.articleManagement")),1)]),_:1}),e(u,{index:"/admin/analytics"},{default:t(()=>[e(o,null,{default:t(()=>[e(s(Ee))]),_:1}),d(" "+n(a.$t("nav.analytics")),1)]),_:1}),z.value?(c(),m(u,{key:1,index:"/admin/settings"},{default:t(()=>[e(o,null,{default:t(()=>[e(s(Qe))]),_:1}),d(" "+n(a.$t("nav.systemSettings")),1)]),_:1})):g("",!0)]),_:1})],64)):g("",!0)]),_:1},8,["default-active","collapse"]),_("div",nt,[e(x,{icon:N.value?s(We):s(Ge),onClick:de,text:"",class:"collapse-btn"},null,8,["icon"])])]),_:1},8,["width"]),e(q,{class:"main-container"},{default:t(()=>[e(we,{class:"header"},{default:t(()=>[_("div",ot,[e(me,{separator:"/"},{default:t(()=>[(c(!0),h(R,null,K(oe.value,(r,A)=>(c(),m(fe,{key:A,to:r.path?{path:r.path}:void 0},{default:t(()=>[d(n(r.label),1)]),_:2},1032,["to"]))),128))]),_:1})]),_("div",lt,[e(pe,{modelValue:$.value,"onUpdate:modelValue":l[0]||(l[0]=r=>$.value=r),placeholder:a.$t("common.search"),"prefix-icon":"Search",class:"search-input",clearable:"",onKeyup:He(ue,["enter"])},null,8,["modelValue","placeholder"]),e(ge,{placement:"bottom-end",width:360,trigger:"click",onShow:G},{reference:t(()=>[e(ve,{value:v.value,hidden:v.value===0,class:"notification-badge"},{default:t(()=>[e(x,{icon:s(Q),circle:""},null,8,["icon"])]),_:1},8,["value","hidden"])]),default:t(()=>[_("div",st,[_("div",it,[_("span",dt,n(a.$t("nav.notifications")),1),k.value.length>0?(c(),m(x,{key:0,type:"primary",link:"",size:"small",onClick:Z},{default:t(()=>[d(n(a.$t("profile.markAllRead")),1)]),_:1})):g("",!0)]),e(y,{style:{margin:"8px 0"}}),k.value.length===0?(c(),h("div",ut,[e(he,{description:a.$t("nav.noNotifications"),"image-size":60},null,8,["description"])])):(c(),h("div",ct,[(c(!0),h(R,null,K(k.value,r=>(c(),h("div",{key:r.id,class:L(["notification-item",{unread:!r.read}]),onClick:A=>Y(r)},[e(o,{class:L(["notification-icon",r.type])},{default:t(()=>[(c(),m(E(J(r.type))))]),_:2},1032,["class"]),_("div",_t,[_("div",ft,n(r.message),1),_("div",mt,n(X(r.time)),1)])],10,rt))),128))]))])]),_:1}),e(be,{trigger:"click",onCommand:ce},{dropdown:t(()=>[e(ke,null,{default:t(()=>[e(P,{command:"profile"},{default:t(()=>[e(o,null,{default:t(()=>[e(s(D))]),_:1}),d(" "+n(a.$t("nav.myProfile")),1)]),_:1}),e(P,{divided:"",command:"logout"},{default:t(()=>[e(o,null,{default:t(()=>[e(s(Xe))]),_:1}),d(" "+n(a.$t("common.logout")),1)]),_:1})]),_:1})]),default:t(()=>[_("div",pt,[e(ye,{size:32,src:se.value},{default:t(()=>[d(n(ie.value),1)]),_:1},8,["src"]),_("span",vt,n(le.value),1),e(o,null,{default:t(()=>[e(s(Je))]),_:1})])]),_:1})])]),_:1}),e(Ce,{class:"main-content"},{default:t(()=>[e($e,null,{default:t(({Component:r,route:A})=>[(c(),m(Ye,{max:10},[(c(),m(E(r),{key:A.fullPath}))],1024))]),_:1})]),_:1})]),_:1})]),_:1})])}}}),bt=et(ht,[["__scopeId","data-v-11107a08"]]);export{bt as default};
