import{an as B,r as i,s as f}from"./index-QtxSC5NZ.js";import{m as n}from"./index-BrCbebx6.js";const _=B("ticket",()=>{const c=i([]),g=i(null),p=i([]),u=i({page:1,pageSize:10,total:0,totalPages:0}),r=i(!1),d=i({}),m=f(()=>c.value.length),k=f(()=>c.value.filter(t=>t.status==="new")),y=f(()=>c.value.filter(t=>["new","assigned","in_progress","pending_user"].includes(t.status))),h=f(()=>c.value.filter(t=>["resolved","closed"].includes(t.status)));async function T(t=1,a=10,o){r.value=!0;try{const e={...d.value,...o},s=await n.getTickets({page:t,pageSize:a,filter:e});if(s.code===200&&s.data){const l=s.data;c.value=l.items,u.value={page:l.page,pageSize:l.pageSize,total:l.total,totalPages:l.totalPages}}}catch(e){console.error("Fetch tickets error:",e)}finally{r.value=!1}}async function w(t=1,a=10,o){r.value=!0;try{const e=await n.getMyTickets({page:t,pageSize:a,status:o});if(e.code===200&&e.data){const s=e.data;c.value=s.items,u.value={page:s.page,pageSize:s.pageSize,total:s.total,totalPages:s.totalPages}}}catch(e){console.error("Fetch my tickets error:",e)}finally{r.value=!1}}async function F(t=1,a=10,o){r.value=!0;try{const e=await n.getAssignedTickets({page:t,pageSize:a,status:o});if(e.code===200&&e.data){const s=e.data;c.value=s.items,u.value={page:s.page,pageSize:s.pageSize,total:s.total,totalPages:s.totalPages}}}catch(e){console.error("Fetch assigned tickets error:",e)}finally{r.value=!1}}async function v(t){r.value=!0;try{const a=await n.getTicketById(t);return a.code===200&&a.data?(g.value=a.data,a.data):null}catch(a){return console.error("Fetch ticket error:",a),null}finally{r.value=!1}}async function S(t){r.value=!0;try{const a=await n.createTicket(t);return a.code===200&&a.data?{success:!0,ticket:a.data}:{success:!1,message:a.message}}catch(a){return console.error("Create ticket error:",a),{success:!1,message:"Failed to create ticket"}}finally{r.value=!1}}async function z(t,a,o){r.value=!0;try{const e=await n.updateTicketStatus(t,a,o);if(e.code===200&&e.data){g.value=e.data;const s=c.value.findIndex(l=>l.id===t);return s!==-1&&(c.value[s]=e.data),{success:!0}}return{success:!1,message:e.message}}catch(e){return console.error("Update ticket status error:",e),{success:!1,message:"Failed to update ticket status"}}finally{r.value=!1}}async function P(t,a,o=!1){r.value=!0;try{const e=await n.addComment(t,{content:a,isInternal:o});return e.code===200&&e.data?(await v(t),{success:!0,comment:e.data}):{success:!1,message:e.message}}catch(e){return console.error("Add comment error:",e),{success:!1,message:"Failed to add comment"}}finally{r.value=!1}}async function C(){try{const t=await n.getCategories();t.code===200&&t.data&&(p.value=t.data)}catch(t){console.error("Fetch categories error:",t)}}function x(t){d.value=t}function A(){d.value={}}return{tickets:c,currentTicket:g,categories:p,pagination:u,loading:r,filter:d,ticketCount:m,newTickets:k,openTickets:y,resolvedTickets:h,fetchTickets:T,fetchMyTickets:w,fetchAssignedTickets:F,fetchTicketById:v,createTicket:S,updateTicketStatus:z,addComment:P,fetchCategories:C,setFilter:x,clearFilter:A}});export{_ as u};
