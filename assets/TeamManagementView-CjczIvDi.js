import{d as ce,k as pe,l as fe,r as u,ai as _e,o as ve,ah as V,c as U,e as r,s as K,f as t,t as n,w as l,g as s,a2 as be,x as C,A as c,i as g,F as ge,J as I,T as z,L as we,ay as ye,aw as $e,K as he,ax as G,y as Te,ag as ke,E as p,af as Ve,h as f}from"./index-Bo1QE9TC.js";import{f as Ce}from"./helpers-BtQK9j-g.js";import{_ as Me}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Fe={class:"team-management-view"},Ue={class:"page-header"},De={class:"team-header"},Ne={class:"team-icon"},Se={class:"team-info"},Ae={class:"member-count"},Be={class:"team-description"},Ie={class:"team-members"},ze={class:"team-footer"},Ee={class:"created-date"},Re={class:"members-dialog"},Le={class:"add-member-section"},qe={class:"members-list"},je=ce({__name:"TeamManagementView",setup(Je){const{t:i}=pe(),H=fe(),D=u(!1),N=u(!1),E=u([]),w=u(!1),M=u(!1),S=u(),d=_e({id:"",name:"",description:""}),F=u(!1),A=u(!1),y=u(null),$=u([]),h=u([]),b=u(""),O={name:[{required:!0,message:()=>i("admin.teamNameRequired"),trigger:"blur"}]};ve(async()=>{H.setBreadcrumbs([{label:i("nav.administration")},{label:i("nav.teamManagement")}]),await T()});async function T(){D.value=!0;try{const e=await V.getTeams();e.code===200&&e.data&&(E.value=e.data)}catch(e){console.error("Failed to load teams:",e)}finally{D.value=!1}}function P(e){return e.split(" ").map(a=>a[0]).join("").toUpperCase().slice(0,2)}function Q(){M.value=!1,d.id="",d.name="",d.description="",w.value=!0}function W(e){M.value=!0,d.id=e.id,d.name=e.name,d.description=e.description||"",w.value=!0}async function X(e){y.value=e,F.value=!0,A.value=!0;try{$.value=e.members||[];const a=await ke.getUsers({page:1,pageSize:100});if(a.code===200&&a.data){const _=a.data.items||a.data,v=$.value.map(m=>String(m.id));h.value=_.filter(m=>!v.includes(String(m.id))&&m.role!=="end_user").map(m=>({id:String(m.id),name:m.name||m.email,role:m.role}))}}catch(a){console.error("Failed to load members:",a),p.error(i("messages.loadFailed"))}finally{A.value=!1}}async function Y(){if(!b.value||!y.value)return;const e=h.value.find(a=>a.id===b.value);if(e)try{await V.addTeamMember(y.value.id,b.value,"member"),$.value.push({id:e.id,userName:e.name,role:"Member"}),h.value=h.value.filter(a=>a.id!==b.value),b.value="",p.success(i("admin.memberAdded")),await T()}catch(a){console.error("Failed to add member:",a),p.error(i("messages.operationFailed"))}}async function Z(e){if(y.value)try{await V.removeTeamMember(y.value.id,e.id),$.value=$.value.filter(a=>a.id!==e.id),h.value.push({id:e.id,name:e.userName}),p.success(i("admin.memberRemoved")),await T()}catch(a){console.error("Failed to remove member:",a),p.error(i("messages.operationFailed"))}}async function x(e){try{await Ve.confirm(`${i("admin.confirmDeleteTeam")} "${e.name}"?`,i("admin.deleteTeam"),{type:"warning"});const a=await V.deleteTeam(e.id);a.code===200?(p.success(i("admin.teamDeleted")),await T()):p.error(a.message||i("messages.operationFailed"))}catch(a){a!=="cancel"&&a?.toString()!=="cancel"&&(console.error("Failed to delete team:",a),p.error(i("messages.operationFailed")))}}async function ee(){S.value&&await S.value.validate(async e=>{if(e){N.value=!0;try{M.value?(await V.updateTeam(d.id,{name:d.name,description:d.description})).code===200&&(p.success(i("admin.teamUpdated")),await T()):(await V.createTeam({name:d.name,description:d.description})).code===200&&(p.success(i("admin.teamCreated")),await T()),w.value=!1}catch(a){console.error("Failed to save team:",a),p.error("Failed to save team")}finally{N.value=!1}}})}return(e,a)=>{const _=s("el-icon"),v=s("el-button"),m=s("el-dropdown-item"),ae=s("el-dropdown-menu"),te=s("el-dropdown"),R=s("el-avatar"),le=s("el-card"),oe=s("el-col"),ne=s("el-row"),L=s("el-input"),q=s("el-form-item"),se=s("el-form"),j=s("el-dialog"),de=s("el-option"),ie=s("el-select"),re=s("el-divider"),B=s("el-table-column"),me=s("el-tag"),ue=s("el-table"),J=be("loading");return f(),U("div",Fe,[r("div",Ue,[r("h1",null,n(e.$t("nav.teamManagement")),1),t(v,{type:"primary",onClick:Q},{default:l(()=>[t(_,null,{default:l(()=>[t(g(ge))]),_:1}),c(" "+n(e.$t("admin.addTeam")),1)]),_:1})]),K((f(),C(ne,{gutter:20},{default:l(()=>[(f(!0),U(I,null,z(E.value,o=>(f(),C(oe,{xs:24,sm:12,lg:8,key:o.id},{default:l(()=>[t(le,{class:"team-card"},{default:l(()=>[r("div",De,[r("div",Ne,[t(_,{size:32},{default:l(()=>[t(g(we))]),_:1})]),r("div",Se,[r("h3",null,n(o.name),1),r("span",Ae,n(o.memberCount)+" "+n(e.$t("admin.teamMembers")),1)]),t(te,{trigger:"click"},{dropdown:l(()=>[t(ae,null,{default:l(()=>[t(m,{onClick:k=>W(o)},{default:l(()=>[t(_,null,{default:l(()=>[t(g($e))]),_:1}),c(" "+n(e.$t("common.edit")),1)]),_:1},8,["onClick"]),t(m,{onClick:k=>X(o)},{default:l(()=>[t(_,null,{default:l(()=>[t(g(he))]),_:1}),c(" "+n(e.$t("admin.manageMembers")),1)]),_:1},8,["onClick"]),t(m,{divided:"",onClick:k=>x(o)},{default:l(()=>[t(_,null,{default:l(()=>[t(g(G))]),_:1}),c(" "+n(e.$t("common.delete")),1)]),_:1},8,["onClick"])]),_:2},1024)]),default:l(()=>[t(v,{text:""},{default:l(()=>[t(_,null,{default:l(()=>[t(g(ye))]),_:1})]),_:1})]),_:2},1024)]),r("p",Be,n(o.description||e.$t("admin.noDescription")),1),r("div",Ie,[(f(!0),U(I,null,z(o.members?.slice(0,5),k=>(f(),C(R,{key:k.id,size:32,class:"member-avatar"},{default:l(()=>[c(n(P(k.userName)),1)]),_:2},1024))),128)),o.memberCount>5?(f(),C(R,{key:0,size:32,class:"member-avatar more"},{default:l(()=>[c(" +"+n(o.memberCount-5),1)]),_:2},1024)):Te("",!0)]),r("div",ze,[r("span",Ee,n(e.$t("admin.createdDate"))+" "+n(g(Ce)(o.createdAt)),1)])]),_:2},1024)]),_:2},1024))),128))]),_:1})),[[J,D.value]]),t(j,{modelValue:w.value,"onUpdate:modelValue":a[3]||(a[3]=o=>w.value=o),title:M.value?e.$t("admin.editTeam"):e.$t("admin.addTeam"),width:"500px"},{footer:l(()=>[t(v,{onClick:a[2]||(a[2]=o=>w.value=!1)},{default:l(()=>[c(n(e.$t("common.cancel")),1)]),_:1}),t(v,{type:"primary",onClick:ee,loading:N.value},{default:l(()=>[c(n(M.value?e.$t("admin.updateTeam"):e.$t("admin.createTeam")),1)]),_:1},8,["loading"])]),default:l(()=>[t(se,{model:d,rules:O,ref_key:"formRef",ref:S,"label-width":"100px"},{default:l(()=>[t(q,{label:e.$t("common.name"),prop:"name"},{default:l(()=>[t(L,{modelValue:d.name,"onUpdate:modelValue":a[0]||(a[0]=o=>d.name=o),placeholder:e.$t("admin.enterTeamName")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(q,{label:e.$t("common.description"),prop:"description"},{default:l(()=>[t(L,{modelValue:d.description,"onUpdate:modelValue":a[1]||(a[1]=o=>d.description=o),type:"textarea",rows:3,placeholder:e.$t("admin.enterTeamDescription")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(j,{modelValue:F.value,"onUpdate:modelValue":a[6]||(a[6]=o=>F.value=o),title:e.$t("admin.manageMembers")+" - "+y.value?.name,width:"600px"},{footer:l(()=>[t(v,{onClick:a[5]||(a[5]=o=>F.value=!1)},{default:l(()=>[c(n(e.$t("common.close")),1)]),_:1})]),default:l(()=>[r("div",Re,[r("div",Le,[t(ie,{modelValue:b.value,"onUpdate:modelValue":a[4]||(a[4]=o=>b.value=o),placeholder:e.$t("admin.selectUser"),filterable:"",style:{width:"300px"}},{default:l(()=>[(f(!0),U(I,null,z(h.value,o=>(f(),C(de,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),t(v,{type:"primary",onClick:Y,disabled:!b.value},{default:l(()=>[c(n(e.$t("admin.addMember")),1)]),_:1},8,["disabled"])]),t(re),r("div",qe,[r("h4",null,n(e.$t("admin.currentMembers")),1),K((f(),C(ue,{data:$.value},{default:l(()=>[t(B,{prop:"userName",label:e.$t("common.name")},null,8,["label"]),t(B,{prop:"role",label:e.$t("admin.memberRole"),width:"150"},{default:l(({row:o})=>[t(me,{size:"small"},{default:l(()=>[c(n(o.role||"Member"),1)]),_:2},1024)]),_:1},8,["label"]),t(B,{label:e.$t("common.actions"),width:"100"},{default:l(({row:o})=>[t(v,{text:"",type:"danger",onClick:k=>Z(o)},{default:l(()=>[t(_,null,{default:l(()=>[t(g(G))]),_:1})]),_:1},8,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[J,A.value]])])])]),_:1},8,["modelValue","title"])])}}}),Oe=Me(je,[["__scopeId","data-v-a57fed03"]]);export{Oe as default};
